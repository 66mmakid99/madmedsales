# 바노바기피부과 v5.5 RAW DATA 대조 분석

> **분석일:** 2026-02-26
> **비교 대상:** v5.5 RAW DATA JSON vs skinbanobagi.com 실제 데이터 (메인 + 2월 랜딩페이지)

---

## 1. 핵심 요약: 5가지 문제

| # | 문제 | 심각도 | 영향 |
|---|------|--------|------|
| P1 | 가격 추출 구조 결함 — 정가/이벤트가 쌍이 분리됨 | 🔴 심각 | 가격 데이터 신뢰도 붕괴 |
| P2 | 가격 3분류(R3-2) 미적용 — priceType 필드 자체가 없음 | 🔴 심각 | regular/event/discount 구분 불가 |
| P3 | 수량+단위 파싱(R3-3) 미적용 — 샷수/cc 정보 손실 | 🟡 중요 | price_per_unit 계산 불가 |
| P4 | 미등록 장비 필드 미작동 — Gemini가 0개 반환 | 🟡 중요 | 사전 자동확장 파이프라인 끊김 |
| P5 | 장비 사전에 약제(보톡스/필러) 카테고리 부재 | 🟡 중요 | 정규화율 35%에 머무는 원인 |
| **P6** | **비급여항목표 80건+ Gemini 무시** — 크롤링됐는데 추출 안 됨 | 🔴 심각 | 단위가격 데이터 전량 손실 |
| **P7** | **landing/index2.html 미크롤링** — 서브페이지 탐색 패턴 누락 | 🔴 심각 | 프로모션 가격 22건+ 수집 불가 |

---

## 2. 문제별 상세 분석

---

### P1. 가격 추출 구조 결함 🔴

#### 현상
`priced_treatments` 7건 vs 실제 가격 데이터 100건+.
- 랜딩페이지 프로모션 가격 22건+ (크롤링 안 됨)
- 비급여항목표 정가 80건+ (크롤링 됐지만 Gemini가 무시)
- `raw_price_texts`에 15개 원문이 수집됐지만, **시술명과 연결이 끊어져 있음.**

#### 원인 추적: raw_price_texts를 실제 가격과 매칭해보면

```
RAW DATA raw_price_texts       →  실제 사이트 매칭
─────────────────────────────────────────────────────
"1,700,000 원"                 →  아이써마지 450샷 [정가]
"129만원~"                     →  컴포트 써마지FLX [이벤트가] ✅ priced에 있음
"350,000 원"                   →  리쥬란 2cc [정가]
"25만원~"                      →  리쥬란 컬렉션 [이벤트가] ✅ priced에 있음
"325,000 원"                   →  엑소좀 Cell-Up [정가]
"19만원~"                      →  엑소좀 패키지 [이벤트가] ✅ priced에 있음
"250,000 원"                   →  실펌엑스 1회 [정가]
"20만원~"                      →  실펌 패키지 [이벤트가] ✅ priced에 있음
"450,000 원"                   →  AquaStem 엑소좀 [정가]
"39만원~"                      →  텐텐 스페셜 [이벤트가] ✅ priced에 있음
"2,520,000 원"                 →  울쎄라피 프라임 400샷 [정가]
"165만원~"                     →  울쎄라피 프라임 패키지 [이벤트가] ✅ priced에 있음
"500,000 원"                   →  쥬비덤 필러 1cc [정가]
"25만원~"                      →  필러 EVENT [이벤트가] ✅ priced에 있음
"0원"                          →  노이즈
```

**발견:** raw_price_texts는 사실 정가(큰 금액)과 이벤트가(작은 금액)이 **교대로** 들어있었음.
그런데 Gemini가 이벤트가만 시술명에 연결하고, 정가는 연결 없이 raw에만 넣음.

#### 결과적으로 놓친 것들

실제 랜딩에 있는데 priced_treatments에 아예 없는 가격:

| 시술 | 정가 | 이벤트가 | 누락 원인 |
|------|------|---------|-----------|
| 리쥬란 X 스킨톡스 (패키지) | 620,000 | 390,000 | raw에도 없음 → 크롤링 자체 누락 |
| 제오민 스킨보톡스 변경시 | 130,000 | 100,000 | raw에도 없음 |
| AquaStem 엑소좀 | 450,000 | 290,000 | raw에 정가만 있음 (이벤트가 누락) |
| 실펌엑스 x 백설주사 | 350,000 | 249,000 | raw에도 없음 |
| 실펌엑스 x 콜라겐 | 600,000 | 390,000 | raw에도 없음 |
| 텐트리플 200샷 | 450,000 | 390,000 | raw에도 없음 |
| 텐트리플 300샷 | 650,000 | 590,000 | raw에도 없음 |
| 텐써마 300샷 | 700,000 | 590,000 | raw에도 없음 |
| 텐써마 600샷 | 1,300,000 | 990,000 | raw에도 없음 |
| 텐텐리프팅 1500 | 1,950,000 | 1,290,000 | raw에도 없음 |
| 주름보톡스 3부위 | 270,000 | 189,000 | raw에도 없음 |
| 울쎄라피 프라임 100샷 추가 | 600,000 | 390,000 | raw에도 없음 |
| 티타늄 50KJ 추가 | 900,000 | 490,000 | raw에도 없음 |
| 아이써마지 450샷 | 1,700,000 | 1,290,000 | raw에 정가만, 이벤트가 없음 |
| 써마지FLX 900샷 | 3,870,000 | 2,690,000 | raw에도 없음 |
| 쥬베룩물광 2.5cc 추가 | 350,000 | 220,000 | raw에도 없음 |

**핵심 발견:** 15개 누락 중 대부분이 raw_price_texts에도 없음.
→ **Gemini가 텍스트를 받지 못했거나, 랜딩페이지 하단 섹션(sec05)을 읽지 못한 것.**
→ 랜딩페이지 sec05(리프팅 GIFT SET)의 텐트리플/텐써마/울쎄라/써마지 가격이 **통째로 누락**됨.

#### 근본 원인 (Claude Code 로컬 분석으로 확정)

Claude Code가 실제 스냅샷 폴더(snapshots/2026-02-22-v4/바노바기피부과/)를 열어 확인한 결과:

**원인 1: landing/index2.html이 50페이지 크롤 대상에 아예 포함되지 않았음** 🔴
- page-001 배너에 `landing/index2.html#sec04`, `#sec05` 링크가 있지만, 이 URL이 크롤 대상 50페이지에 없음
- 이 페이지에 정가→이벤트가 쌍 22건+가 텍스트로 존재하는데, 크롤 자체를 안 함
- → 서브페이지 탐색 규칙(R8-1)의 `/landing/` 패턴이 빠져있는 것이 원인

**원인 2: page-030/031 비급여항목표 80건+를 Gemini가 통째로 무시** 🔴
- 크롤링된 page-030, page-031에 마크다운 테이블 형식으로 비급여항목 가격표가 약 87행씩 존재
- 내용: 주름보톡스 30,000~180,000 / 사각턱보톡스 35,000~330,000 / 필러 69,000~370,000 / 인모드 79,000~179,000 / 슈링크 49,000 / 울쎄라 400,000 / 텐쎄라 250,000 / 텐써마 400,000 / 리쥬란힐러 240,000 등 80건+
- **데이터는 크롤링되어 있었는데 Gemini가 추출하지 않음**
- 원인: 150,000자 입력에서 비급여표가 50페이지 텍스트 속에 묻혀 우선순위 밀림 + "비급여항목안내 테이블에서 가격을 추출하라"는 명시적 프롬프트 지시 없음

**원인 3: 스크린샷이 페이지 상단만 캡처** 🟡
- page-021(시술정보 메인) 스크린샷이 헤더 영역만 포함, 아래쪽 가격 카드 미포함
- → 멀티스크롤 캡처 미적용

**원인 4: Gemini 프롬프트에 정가/이벤트가 쌍 추출 지시 부족**
- priceType 필드가 스키마에 없어서 Gemini가 구분하지 않음

#### 실제 가격 데이터 분포 (Claude Code 확인)

```
┌─────────────────────┬────────────┬────────────────────────────────┬──────────┐
│ 페이지              │ 가격패턴수 │ 내용                           │ Gemini   │
├─────────────────────┼────────────┼────────────────────────────────┼──────────┤
│ page-021            │ 14개       │ 이벤트 카드 (프로모션)         │ 7개 추출 │
│ page-030            │ 85+개      │ 비급여항목표 (단위가격)        │ 0개 추출 │
│ page-031            │ 85+개      │ 비급여항목표 (중복, 동일)      │ 0개 추출 │
│ page-022            │ 23개       │ 진료안내 (시간/주소 숫자)      │ 제외 정상│
│ landing/index2.html │ 미크롤     │ 정가→이벤트가 패키지 22건+     │ 크롤 안됨│
├─────────────────────┼────────────┼────────────────────────────────┼──────────┤
│ 합계                │ 200+       │ 실제 가격: ~100건+             │ 7건 추출 │
└─────────────────────┴────────────┴────────────────────────────────┴──────────┘
```

**내 초기 분석의 오류 정정:**
- 나는 "가격이 이미지 안에 있어서 못 잡았을 것"이라고 추정했지만, 실제로는:
  - landing 페이지: 크롤 대상에 아예 없었음 (이미지 문제가 아닌 크롤링 범위 문제)
  - 비급여표: 텍스트로 크롤링되어 있었는데 Gemini가 무시함 (프롬프트 문제)
- 실제 누락 가격 수는 22개가 아닌 **100건+** (비급여표 80건 + 랜딩 22건)

---

### P2. 가격 3분류 미적용 🔴

#### 현상
규칙 사전 R3-2에서 정의한 `priceType: "regular" | "event" | "discount"` 필드가 Gemini 응답 스키마에 없음.

#### RAW DATA의 priced_treatments 구조

```json
{
  "name": "컴포트 써마지FLX",
  "price": 1290000,           ← 단일 가격만 있음
  "price_display": "129만원~",
  "is_package": false,        ← 패키지 여부만 있음
  "category": ["리프팅"]
}
```

#### 있어야 하는 구조 (R3-2 + R3-3 적용)

```json
{
  "name": "컴포트 써마지FLX",
  "regular_price": 1700000,     ← 아이써마지 450샷 정가 (같은 써마지이면 다른 상품)
  "event_price": 1290000,
  "price_type": "event",
  "quantity": 900,              ← "900샷"에서 추출
  "unit": "shot",
  "price_per_unit": 1433,       ← 1,290,000 / 900
  "event_period": "2월 한정",
  "includes": ["써마지FLX 900샷", "무통수액"],
  "category": ["리프팅"]
}
```

#### 해결 방안

Gemini 응답 스키마에 아래 필드를 **필수 추가**:
- `price_type`: "regular" | "event" | "discount"
- `regular_price`: 정가 (있으면)
- `event_price`: 이벤트가 (있으면)
- `discount_rate`: 할인율 (있으면)
- `quantity`: 수량
- `unit`: 단위 (shot/cc/unit/session 등)
- `price_per_unit`: 자동계산
- `event_period`: 이벤트 기간 텍스트
- `includes`: 패키지 구성 항목 배열

---

### P3. 수량+단위 파싱 미적용 🟡

#### 현상
실제 사이트에는 샷수/용량 정보가 풍부한데, 전부 무시됨.

```
랜딩페이지 원문                    →  파싱되어야 할 것
────────────────────────────────────────────────────
텐트리플 200샷 600라인              →  qty:200, unit:shot, lines:600
텐트리플 300샷 900라인              →  qty:300, unit:shot, lines:900
텐써마 300샷                       →  qty:300, unit:shot
텐써마 600샷                       →  qty:600, unit:shot
울쎄라피 프라임 400샷               →  qty:400, unit:shot
울쎄라피 프라임 100샷 (추가시)      →  qty:100, unit:shot
아이써마지 450샷                    →  qty:450, unit:shot
써마지FLX 900샷                    →  qty:900, unit:shot
리쥬란 2CC                         →  qty:2, unit:cc
쥬베룩물광 2.5cc                   →  qty:2.5, unit:cc
스킨보톡스 2CC                     →  qty:2, unit:cc
유스힐 3cc                         →  qty:3, unit:cc
ASCE 2.5cc                        →  qty:2.5, unit:cc
티타늄 50KJ                        →  qty:50, unit:kJ
쥬비덤 필러 1CC                    →  qty:1, unit:cc
```

이 데이터가 파싱되면 **price_per_unit** 계산이 가능하고, 
"울쎄라 300샷 79만원" vs "울쎄라 400샷 165만원" 같은 **가격 비교**가 됨.
→ profiler의 Investment 축 점수 산출에 직접 활용 가능.

---

### P4. unregistered 필드 미작동 🟡

#### 현상

```json
"unregistered_equipment_count": 0,
"unregistered_treatments_count": 0
```

그런데 `unmatched_devices`에는 20개나 있음. 
→ Gemini가 `unregistered_equipment` 배열을 사용하지 않고, 자기 나름대로 전부 `medical_devices`에 넣음.
→ 사후에 normalization map으로 매칭 실패한 것을 "미등록"으로 분류하는 구조.

#### 문제점

이 방식은 **Gemini가 이미 "이건 새로운 장비다"라고 인식한 정보를 활용하지 못함.**
Gemini는 문맥을 보고 "이건 사전에 없는 장비인데 설명상 스킨부스터다"라고 판단할 수 있는데,
현재는 그 판단을 버리고 코드 레벨에서 단순 문자열 매칭만 함.

#### 해결 방안

Gemini 프롬프트에 **명시적으로** 지시:

```
## 미등록 장비/시술 처리

당신이 받은 [장비 사전]에 없는 장비나 시술이 발견되면:

1. 해당 항목을 equipments/treatments에는 정상적으로 포함
2. 동시에 아래 형태로 unregistered_equipment에도 추가:

{
  "name": "TenTriple",
  "korean_name": "텐트리플",
  "suggested_category": "HIFU",  ← 당신이 판단한 카테고리
  "reason": "텐써마+텐쎄라 조합 장비로 보임"  ← 판단 근거
}

이것은 사전을 자동으로 확장하기 위한 것입니다.
사전에 없다고 버리지 마세요. 반드시 양쪽 모두에 넣으세요.
```

---

### P5. 장비 사전에 약제 카테고리 부재 🟡

#### 현상
미등록 20개 중 상당수가 "약제(injectable)"인데, 장비 사전은 "장비(device)" 중심으로 설계됨.

| 미등록 항목 | 실제 분류 | 사전 상태 |
|------------|----------|----------|
| Xeomin (제오민) | 보톡스 약제 | 시술 키워드(D2-4)에만 있음, 장비 사전(D1)에 없음 |
| Botox (보톡스) | 보톡스 약제 | 시술 키워드에만 있음 |
| Belotero Soft | 필러 약제 | 시술 키워드(D2-5)에만 있음 |
| Skinvive (스킨바이브) | 스킨부스터 | 아예 미등록 |
| Youtheal (유스힐) | 스킨부스터 | 아예 미등록 |
| Laetigen (래티젠) | 콜라겐자극제 | 아예 미등록 |
| 백옥주사 | 미백주사 | 시술 키워드에도 없음 (!) |
| 엑소좀 | 스킨부스터 | 시술 키워드(D2-3)에만 있음 |
| 스킨보톡스 | 보톡스 시술 | 시술 키워드에만 있음 |

#### 근본 원인

현재 장비 사전(D1)과 시술 키워드(D2)가 **분리되어 있는데**,
한국 피부과에서는 "약제 = 장비 = 시술"이 혼용됨.
- "제오민 맞았어요" = 제오민(약제)으로 보톡스(시술)를 시술함
- "리쥬란 2cc" = 리쥬란(약제)을 물광주사(장비) 등으로 주입
- "스킨바이브" = 스킨바이브(약제) 자체가 시술명

#### 해결 방안

장비 사전(D1)에 **D1-5. 약제/주사제** 카테고리 신설:

```json
"INJECTABLE": [
  { "standard": "Xeomin", "ko": ["제오민"], "en": ["Xeomin"], "subtype": "botox" },
  { "standard": "Botox", "ko": ["보톡스"], "en": ["Botox", "BOTOX"], "subtype": "botox" },
  { "standard": "Nabota", "ko": ["나보타"], "en": ["Nabota"], "subtype": "botox" },
  { "standard": "Juvederm", "ko": ["쥬비덤"], "en": ["Juvederm", "JUVEDERM"], "subtype": "filler" },
  { "standard": "Restylane", "ko": ["레스틸렌"], "en": ["Restylane"], "subtype": "filler" },
  { "standard": "Belotero", "ko": ["벨로테로"], "en": ["Belotero"], "gen": ["Soft", "Balance", "Intense"], "subtype": "filler" },
  { "standard": "Skinvive", "ko": ["스킨바이브"], "en": ["Skinvive", "SkinVive"], "subtype": "booster" },
  { "standard": "Youtheal", "ko": ["유스힐"], "en": ["Youtheal"], "subtype": "booster" },
  { "standard": "Laetigen", "ko": ["래티젠", "레티젠"], "en": ["Laetigen"], "subtype": "collagen" },
  { "standard": "ASCE", "ko": ["에이에스씨이"], "en": ["ASCE"], "subtype": "exosome" }
]
```

---

### P6. 비급여항목표 80건+ Gemini 무시 🔴 (Claude Code 발견)

#### 현상
Claude Code가 로컬 스냅샷 폴더를 직접 열어 확인한 결과, page-030과 page-031에 **비급여항목 가격표가 약 87행**씩 존재. 이 데이터는 크롤링이 되어 텍스트로 포함되어 있었지만, Gemini가 추출을 하지 않음.

#### page-030/031 비급여항목표에 있는 실제 가격 (일부)

```
주름보톡스(국산)          30,000 ~ 180,000
사각턱보톡스             35,000 ~ 330,000
특수부위보톡스           70,000 ~ 370,000
스킨/다한증보톡스         70,000 ~ 260,000
체형보톡스              110,000 ~ 900,000
필러 아띠에르            69,000
필러 쥬비덤             370,000
실리프팅 모노실           50,000
실리프팅 실루엣소프트    1,000,000
인모드                  79,000 ~ 179,000
슈링크                  49,000
울쎄라                  400,000
쓰리딥                  40,000
텐쎄라                  250,000
텐써마                  400,000
리쥬란힐러              240,000
유스힐                  400,000
실펌                    250,000
레이저토닝               40,000 ~ 89,000
지방분해주사            120,000
삭센다                  100,000
수액                    30,000 ~ 100,000
... 등 총 80건+
```

#### 왜 심각한가
이 비급여항목표는 **정가(regular price) 데이터의 원천**임.
- 랜딩페이지의 이벤트가와 비급여표의 정가를 결합하면 → 완전한 가격 3분류 가능
- 비급여표의 시술별 단위가격은 profiler의 Investment 축 점수 산출에 직접 사용 가능
- 이 데이터 없이는 "이 병원이 비싼 병원인지 저렴한 병원인지" 판단 불가

#### 원인
1. 150,000자 입력 중 비급여표가 중반부(page-030)에 위치 → Gemini가 앞뒤 문맥에 밀려 우선순위 낮게 처리
2. 마크다운 테이블(| | |) 형식이 다른 텍스트 대비 구조적으로 눈에 띄지 않음
3. 프롬프트에 "비급여항목안내 테이블이 있으면 모든 행을 추출하라"는 명시적 지시 없음
4. page-030, page-031에 동일 테이블이 중복 → 노이즈로 판단했을 가능성

#### 해결 방안

**프롬프트에 비급여표 추출 규칙 추가:**

```
## 비급여항목표 추출 (필수)

크롤링 데이터에 "비급여", "비급여항목", "비급여안내", "비급여 진료비" 등의
키워드와 함께 가격 테이블이 있으면:

1. 테이블의 모든 행을 추출하세요 (한 건도 빠뜨리지 마세요)
2. 각 행의 형태: { name: "시술명", price: 금액, price_type: "regular" }
3. 가격 범위 ("30,000~180,000")는 min_price, max_price로 분리
4. 이 가격들은 정가(regular)입니다. 이벤트가와 별도로 기록하세요.

비급여표는 병원의 공식 가격이므로 가장 신뢰도가 높은 가격 데이터입니다.
절대 건너뛰지 마세요.
```

**또는 코드 레벨 전처리:**
page-030/031의 비급여표를 크롤링 단계에서 별도 추출하여,
Gemini 호출 시 `비급여_가격표` 섹션으로 분리 주입 → 150K 텍스트에 묻히지 않게 처리

---

### P7. landing/index2.html 미크롤링 🔴 (Claude Code 발견)

#### 현상
바노바기피부과의 2월 프로모션 가격이 모두 들어있는 핵심 페이지 `skinbanobagi.com/landing/index2.html`이 50페이지 크롤 대상에 포함되지 않았음.

#### 증거
- page-001(메인 배너)에 landing 페이지 링크가 존재:
  - `landing/index2.html` (GLOW 특집)
  - `landing/index2.html#sec04` (피부결 패키지)
  - `landing/index2.html#sec05` (리프팅 GIFT)
- 하지만 50개 크롤 페이지 목록에 이 URL 없음

#### 왜 빠졌나
현재 서브페이지 탐색 규칙(R8-1)의 URL 패턴:
```
/시술안내, /service, /treatment
/장비소개, /equipment, /device
/이벤트, /event, /promotion
/의료진, /doctor, /원장
/가격, /price, /비용
```

**`/landing/` 패턴이 없음!**
한국 피부과들이 이벤트/프로모션 가격을 별도 랜딩페이지로 만드는 경우가 많은데,
이 패턴이 서브페이지 탐색 목록에서 빠져있었음.

#### 해결 방안

1. **규칙 사전 R8-1에 `/landing/` 패턴 추가:**
```
- 이벤트: /이벤트, /event, /promotion, /landing, /special, /campaign
```

2. **배너 링크 자동 탐색 로직:**
메인 페이지 배너(슬라이더)에 있는 내부 링크는 대부분 이벤트/프로모션 페이지.
배너 영역의 `<a href>` 중 같은 도메인 링크를 자동으로 크롤 대상에 추가.

3. **Firecrawl 설정에 landing 경로 포함:**
```
includePaths: ["/landing/*", "/event/*", "/promotion/*", "/special/*"]
```

---

## 3. 추가 발견 사항

### 3-1. 시술 감지: 양호하지만 검증 필요

87개 시술 감지는 양적으로 충분. 하지만:
- `total_treatments: 87`(statistics) vs `total_treatments: 60`(extraction_summary) → **수치 불일치** (어디서 27개 차이?)
- 조합 시술 "슈링크+텐써마", "텐써마+텐쎄라" 감지는 좋음
- 하지만 "텐텐리프팅 1500 = 텐트리플 300샷 + 텐써마 600샷"이라는 **구성 내용**은 파싱 안 됨

### 3-2. SNS 누락

```json
"instagram": null,   ← 실제: @banobagi_skin (1,087 팔로워)
"youtube": null,     ← 실제: youtube.com/@BNBG_SKIN (메인에 링크 있음)
"blog": null
```

메인 페이지에 유튜브 링크(`youtube.com/channel/UCglQ_gvV5TSsyVBBg8B4Jzw`)와
인스타그램(@banobagi_skin)이 있는데 못 잡음.

### 3-3. 네이버 플레이스 URL 검증 필요

```json
"naver_place": "https://naver.me/501o2x8E"
```
이 URL이 실제 바노바기피부과를 가리키는지 확인 필요.

### 3-4. 장비 subcategory 오류

```json
{ "name": "FairTitanium", "subcategory": "laser" }  
```
페어티타늄은 RF 장비인데 laser로 분류됨. 사전에 `RF_TIGHTENING`으로 명시되어 있는데 반영 안 됨.

### 3-5. Tenssera vs Tensera 이중 감지

matched_devices에 "Tensera"가 있고, unmatched_devices에 "Tenssera"가 있음.
→ 같은 장비의 영문 스펠링 변형인데 하나만 매칭됨.
→ 사전의 en 변형에 "Tenssera" 추가 필요.

### 3-6. 논문 출처 장비 오염

unmatched 중 IFU, CPMHA, Botox에 description이 "(목주름 치료 연구 논문에 언급)"으로 되어있음.
→ 학술논문 텍스트에서 추출된 장비가 **실제 보유 장비와 혼합**됨.
→ 출처별 분리 필요: `source: "website"` vs `source: "academic_paper"`

---

## 4. 해결 방안 종합

### 즉시 조치 (사전 업데이트만으로 해결 가능)

#### 4-1. 장비 사전 확장 — dictionary JSON 수정

추가할 항목 9개:

| 표준명 | 한글 | 영문 변형 | 카테고리 | 비고 |
|--------|------|----------|----------|------|
| TenTriple | 텐트리플 | TenTriple | HIFU | 3LINE HIFU, 텐써마+텐쎄라 조합 |
| TuneLiner | 튠라이너 | TuneLiner | HIFU | 지방파괴 초음파, 이중턱 용도 |
| Laetigen | 래티젠, 레티젠 | Laetigen | SKINBOOSTER (collagen) | 순도 99.9% 콜라겐 |
| Youtheal | 유스힐 | Youtheal | SKINBOOSTER (PDRN) | 듀얼 PDRN + 엑소좀 |
| Skinvive | 스킨바이브 | Skinvive, SkinVive | SKINBOOSTER (HA) | 프리미엄 물광주사 |
| Dermashine | 더마샤인 | Dermashine | DEVICE (injector) | 멀티니들 약물주입 장비 |

기존 항목 보강 3개:

| 표준명 | 추가할 변형 | 위치 |
|--------|-----------|------|
| Tensera | en에 "Tenssera" 추가 | D1-1 |
| SopranoICE | gen에 "Titanium" 추가 | D1-2 |
| Fraxel | gen에 "Dual" 추가 | D1-2 |

약제 카테고리 신설 (D1-5 INJECTABLE):
- Xeomin, Botox, Nabota, Juvederm, Restylane, Belotero, ASCE 등

시술 키워드 추가:
- D2-8 기타 시술에 "백옥주사" 추가 (현재 누락)
- D2-3 스킨부스터에 "스킨바이브", "유스힐", "래티젠" 추가

### 코드 수정 필요 (Claude Code 명령문)

#### 4-2. Gemini 응답 스키마 v2: 가격 구조 개편

```json
{
  "priced_treatments": [
    {
      "name": "string",
      "regular_price": "number|null",
      "event_price": "number|null", 
      "discount_price": "number|null",
      "price_type": "regular|event|discount",
      "quantity": "number|null",
      "unit": "shot|cc|unit|vial|syringe|session|area|kJ|null",
      "price_per_unit": "number|null",
      "event_period": "string|null",
      "includes": ["string"],
      "is_package": "boolean",
      "source_section": "string",
      "category": ["string"]
    }
  ]
}
```

#### 4-3. Gemini 프롬프트 보강: 가격 추출 강화 지시

```
## 가격 추출 규칙 (강화)

1. 취소선 가격 또는 큰 숫자 → 작은 숫자 패턴이 보이면:
   - 큰 숫자 = regular_price (정가)
   - 작은 숫자 = event_price (이벤트가)
   - price_type = "event"

2. "~만원", "~원" 형태의 가격이 시술명 근처에 있으면 반드시 추출.
   시술명과 가격이 같은 섹션/블록에 있으면 연결하세요.

3. 샷수/용량이 시술명에 포함되어 있으면:
   - quantity, unit 필드에 분리하여 기록
   - price_per_unit = event_price / quantity (또는 total_price / quantity)

4. "추가시" 가격은 별도 항목으로 분리:
   - is_addon: true
   - 예: "★써마지FLX ONLY★ 쥬베룩물광 2.5cc 220,000원" → is_addon: true

5. 하나의 시술에 정가와 이벤트가 모두 보이면, 반드시 둘 다 기록.
   절대 이벤트가만 넣고 정가를 버리지 마세요.
```

#### 4-4. unregistered 필드 프롬프트 강화

```
## 미등록 장비/시술 처리 (필수)

[장비 사전]에 없는 장비/약제가 보이면:
1. equipments 배열에 정상 포함 (절대 빼지 마세요)
2. unregistered_equipment 배열에도 추가:
   {
     "name": "영문명",
     "korean_name": "한글명",
     "suggested_category": "카테고리 추정",
     "reason": "판단 근거 한줄"
   }

학술논문에서만 언급된 장비는 source: "paper"로 표시하여 구분하세요.
실제 병원 시술 메뉴/소개에 있는 장비만 source: "website"로 표시하세요.
```

#### 4-5. 출처 구분 (website vs paper)

RAW DATA에서 IFU, CPMHA, Botox(논문 출처)가 실제 보유 장비와 섞여있음.
학술활동 페이지에서 추출된 장비는 `source: "academic"` 태그를 붙여 분리.

#### 4-6. SNS 감지 보강

YouTube, Instagram 감지 패턴 추가:
```
instagram.com/ → "instagram" 필드
youtube.com/ 또는 youtu.be/ → "youtube" 필드
@으로 시작하는 소셜 핸들 → 해당 플랫폼에 매핑
```

---

## 5. 우선순위 정리 (Claude Code 분석 반영 최종)

### Phase 1: 사전만 수정 (코드 변경 없음, 즉시 가능)
1. dictionary JSON에 장비 9개 추가 + 변형 3개 보강
2. 약제 카테고리(D1-5 INJECTABLE) 신설
3. 시술 키워드에 누락 3개 추가
4. 규칙 사전 R8-1에 `/landing/` 서브페이지 패턴 추가

→ **예상 효과: 장비 정규화율 35% → 65%+**

### Phase 2: Gemini 스키마 + 프롬프트 수정 (Claude Code 명령)
5. priced_treatments 스키마 v2 적용 (정가/이벤트가/수량/단위)
6. **비급여항목표 추출 규칙 프롬프트에 추가 (P6 해결)**
7. unregistered 필드 프롬프트 강화
8. 출처 구분(website vs paper) 로직 추가
9. SNS 감지 패턴 보강

→ **예상 효과: 가격 감지율 7건 → 80건+, 사전 자동확장 파이프라인 가동**

### Phase 3: 크롤링 범위 개선 (Firecrawl 설정)
10. **landing/index2.html 크롤 대상 추가 (P7 해결)**
11. Firecrawl includePaths에 `/landing/*`, `/special/*`, `/campaign/*` 추가
12. 메인 배너 링크 자동 탐색 로직 추가
13. 멀티스크롤 스크린샷 (가격 페이지 전체 캡처)

→ **예상 효과: 가격 감지율 80건 → 100건+ (전체 가격 회수)**

### Phase별 예상 가격 감지 흐름

```
현재 (v5.5):  7건 감지  ← 이벤트 카드만
Phase 1 후:   7건 (사전은 정규화만 개선, 가격 구조는 동일)
Phase 2 후:  80건+ ← 비급여표 80건 + 이벤트 7건 (크롤링된 데이터 완전 추출)
Phase 3 후: 100건+ ← 랜딩페이지 22건 추가 (정가→이벤트가 쌍 포함)
```

---

## 6. Claude Code 명령문

아래 명령문을 Phase 1 → Phase 2 순서로 실행하세요.

### Phase 1 명령문 (사전 업데이트)

```
# MADMEDSALES 사전 v1.1 업데이트 — 바노바기 테스트 결과 반영

## 작업: scripts/crawler/MADMEDSALES_dictionary_v1.0.json 수정

### 1. equipment 섹션에 신규 장비 추가

HIFU 카테고리에 추가:
- TenTriple: ko["텐트리플"], en["TenTriple"], gen[]
- TuneLiner: ko["튠라이너"], en["TuneLiner"], gen[]

SKINBOOSTER 카테고리에 추가:
- Skinvive: ko["스킨바이브"], en["Skinvive", "SkinVive"], gen[]
- Youtheal: ko["유스힐"], en["Youtheal"], gen[]
- Laetigen: ko["래티젠", "레티젠"], en["Laetigen"], gen[]
- ASCE: ko["에이에스씨이", "아스"], en["ASCE"], gen[]

DEVICE (별도 카테고리 "INJECTOR" 신설):
- Dermashine: ko["더마샤인"], en["Dermashine"], gen[]

### 2. 기존 항목 변형 보강

- Tensera: en 배열에 "Tenssera" 추가
- SopranoICE: gen 배열에 "Titanium" 추가
- Fraxel: gen 배열에 "Dual" 추가

### 3. 약제 카테고리 신설 (equipment 안에 "INJECTABLE" 키 추가)

{
  "INJECTABLE": [
    { "standard": "Xeomin", "ko": ["제오민"], "en": ["Xeomin", "XEOMIN"], "gen": [], "subtype": "botox" },
    { "standard": "Botox", "ko": ["보톡스"], "en": ["Botox", "BOTOX"], "gen": [], "subtype": "botox" },
    { "standard": "Nabota", "ko": ["나보타"], "en": ["Nabota"], "gen": [], "subtype": "botox" },
    { "standard": "Botulax", "ko": ["보툴렉스"], "en": ["Botulax"], "gen": [], "subtype": "botox" },
    { "standard": "Dysport", "ko": ["디스포트"], "en": ["Dysport"], "gen": [], "subtype": "botox" },
    { "standard": "Coretox", "ko": ["코어톡스"], "en": ["Coretox"], "gen": [], "subtype": "botox" },
    { "standard": "Juvederm", "ko": ["쥬비덤"], "en": ["Juvederm", "JUVEDERM"], "gen": ["볼륨", "볼루마", "볼벨라", "울트라"], "subtype": "filler" },
    { "standard": "Restylane", "ko": ["레스틸렌"], "en": ["Restylane"], "gen": ["리도"], "subtype": "filler" },
    { "standard": "Belotero", "ko": ["벨로테로"], "en": ["Belotero"], "gen": ["Soft", "Balance", "Intense", "Volume"], "subtype": "filler" }
  ]
}

### 4. 시술 키워드 추가

treatment_keywords.other에 추가: "백옥주사"
treatment_keywords.skinbooster에 추가: "스킨바이브", "유스힐", "래티젠", "ASCE"
treatment_keywords.laser에 추가: "프락셀듀얼"

### 5. _meta 버전 업데이트

version: "1.0.0" → "1.1.0"
updated: "2026-02-26"

### 6. dictionary-loader.ts 수정

getEquipmentNormalizationMap()이 새로 추가된 INJECTABLE, INJECTOR 카테고리도 포함하도록 수정.
INJECTABLE의 subtype 필드도 매핑에 포함.

### 7. 규칙 사전 R8-1 서브페이지 패턴 업데이트

docs/MADMEDSALES_규칙사전_v1.0.md 파일에서 R8-1 서브페이지 목록에 추가:
- 이벤트 행: /이벤트, /event, /promotion **→ /landing, /special, /campaign 추가**

또한 Firecrawl 크롤링 설정(config 또는 스크립트)에서 includePaths에 추가:
```
"/landing/*", "/special/*", "/campaign/*"
```
바노바기 landing/index2.html처럼 이벤트 가격이 별도 랜딩페이지에 있는 패턴이 한국 피부과에 많음.

### 검증

수정 완료 후 다시 바노바기 1건 테스트 실행.
이전 결과(matched 11개, unmatched 20개)와 비교하여:
- matched 개수가 늘었는지 보고
- 여전히 unmatched인 항목 보고
```

### Phase 2 명령문 (스키마 + 프롬프트 개편)

```
# MADMEDSALES v5.6 — Gemini 가격 스키마 + 프롬프트 개편

## 배경

v5.5 바노바기 테스트에서 가격 감지율 7건/100건+. 원인:
1. priced_treatments 스키마에 priceType/정가/이벤트가 구분 없음
2. 수량(샷수/cc)+단위 파싱 안 됨
3. **비급여항목표 80건+가 크롤링 데이터에 있는데 Gemini가 전부 무시** (가장 큰 원인)
4. unregistered 필드를 Gemini가 사용하지 않음
5. 학술논문 출처 장비가 실제 보유 장비와 혼합됨
6. Instagram/YouTube 감지 누락

## 작업 1: priced_treatments 스키마 v2

Gemini에게 보내는 응답 스키마에서 priced_treatments의 각 항목을 아래로 교체:

{
  "name": "string (시술명 원문 그대로)",
  "regular_price": "number|null (정가, 취소선 가격)",
  "event_price": "number|null (이벤트가, 할인가, 실제 결제가)",
  "price_type": "regular|event|discount",
  "quantity": "number|null (300샷이면 300)",
  "unit": "shot|cc|unit|vial|syringe|session|area|kJ|null",
  "price_per_unit": "number|null (event_price ÷ quantity, 자동계산)",
  "event_period": "string|null (예: '2월 한정')",
  "includes": ["string (패키지 구성 항목)"],
  "is_package": "boolean",
  "is_addon": "boolean (추가시 가격 여부)",
  "source_section": "string|null (어느 페이지/섹션에서 추출했는지)",
  "category": ["string"]
}

## 작업 2: Gemini 프롬프트 가격 추출 섹션 강화

기존 가격 관련 프롬프트를 찾아서, 아래 내용을 추가/교체:

---

### 가격 추출 규칙 (필수 준수)

1. **정가+이벤트가 쌍 추출**
   취소선 가격이나 큰 숫자→작은 숫자 패턴이 보이면:
   - 큰 숫자 = regular_price
   - 작은 숫자 = event_price
   - price_type = "event"
   절대로 이벤트가만 넣고 정가를 버리지 마세요.

2. **수량+단위 파싱**
   "울쎄라 300샷 79만원" → quantity: 300, unit: "shot", event_price: 790000
   "리쥬란 2CC 25만원" → quantity: 2, unit: "cc", event_price: 250000
   "티타늄 50KJ 49만원" → quantity: 50, unit: "kJ", event_price: 490000
   price_per_unit = event_price ÷ quantity

3. **패키지 구성 분리**
   "텐텐리프팅 1500 = 텐트리플 300샷(900라인) + 텐써마 600샷"
   → name: "텐텐리프팅 1500"
   → includes: ["텐트리플 300샷 900라인", "텐써마 600샷"]
   → is_package: true

4. **추가시 가격 분리**
   "★울쎄라피 프라임 ONLY★ 주름보톡스 3부위 189,000원"
   → is_addon: true (독립 시술이 아닌 추가 옵션)

5. **섹션 이름 기록**
   가격을 발견한 페이지 섹션을 source_section에 기록.
   (예: "landing/2월프로모션/리프팅GIFT", "메인/시술소개")

6. **비급여항목표 전수 추출 (필수!)**
   크롤링 데이터에 "비급여", "비급여항목", "비급여안내", "비급여 진료비" 등의
   키워드와 함께 테이블(마크다운 |...|...| 형식)이 있으면:
   - 테이블의 **모든 행**을 추출하세요 (한 건도 빠뜨리지 마세요)
   - 각 행: { name: "시술명", price: 금액, price_type: "regular" }
   - 가격 범위 ("30,000~180,000")는 min_price, max_price로 분리
   - 이 가격들은 정가(regular)입니다
   - 비급여표는 병원의 공식 가격이므로 가장 신뢰도가 높은 가격 데이터입니다
   - 150,000자 텍스트에 묻혀있더라도 반드시 찾아서 추출하세요
   - 동일 테이블이 여러 페이지에 중복되면 1벌만 추출 (중복 제거)

---

## 작업 2-B: 비급여표 전처리 (코드 레벨)

Gemini에게 150,000자를 한꺼번에 보내면 비급여표가 묻히는 문제가 있으므로,
크롤링 데이터를 Gemini에게 보내기 전에 전처리:

1. 크롤링된 페이지들 중 "비급여" 키워드가 포함된 페이지를 찾아라
2. 해당 페이지의 마크다운 테이블을 별도로 추출
3. Gemini 프롬프트 구성 시, 메인 텍스트와 별도로 "비급여가격표" 섹션을 만들어 주입:

```
## 병원 웹사이트 텍스트
[... 메인 크롤링 텍스트 ...]

## ★★★ 비급여항목 가격표 (반드시 전수 추출) ★★★
[... 비급여표 마크다운 테이블만 분리하여 삽입 ...]
```

이렇게 하면 150K 텍스트에서 비급여표가 묻히지 않음.

---

## 작업 3: unregistered 필드 프롬프트 강화

Gemini 프롬프트에 아래 섹션 추가:

---

### 미등록 장비/시술 처리 (필수)

[장비 사전]에 없는 장비나 약제를 발견하면:

1. equipments 배열에 정상 포함 (절대 제외하지 마세요)
2. unregistered_equipment 배열에도 아래 형태로 추가:

{
  "name": "영문명 또는 원문",
  "korean_name": "한글명",
  "suggested_category": "RF_TIGHTENING|HIFU|LASER|SKINBOOSTER|INJECTABLE|DEVICE",
  "source": "website|academic_paper",
  "reason": "판단 근거 한줄"
}

source 구분 기준:
- "website": 시술 메뉴, 이벤트, 가격표, 장비 소개에 있는 것
- "academic_paper": 학술활동, 논문, 연구발표에서만 언급된 것

학술논문에서만 나온 장비(IFU, CPMHA 등)는 source: "academic_paper"로 표시.
이를 통해 실제 보유 장비와 연구 참조 장비를 구분합니다.

시술도 동일: [시술 키워드]에 없는 시술명 → unregistered_treatments에 추가.

---

## 작업 4: SNS 감지 보강

연락처 추출 관련 코드에서 instagram, youtube 감지 로직을 확인.
메인 페이지 소스에 있는데 못 잡은 것이므로:

- <a href="...instagram.com/..."> → instagram 필드
- <a href="...youtube.com/..."> 또는 youtu.be/ → youtube 필드
- "★HOT 유튜브 바로보기" 같은 텍스트 + youtube 링크 → youtube

크롤링 데이터에서 이 패턴을 Gemini가 추출하도록 프롬프트에 명시:
"SNS 채널: instagram.com, youtube.com, youtu.be, blog.naver.com 등의 URL이 보이면 해당 필드에 기록하세요."

## 작업 5: 장비 subcategory 검증

dictionary-loader에서 장비 사전의 카테고리 코드를 Gemini 프롬프트에 포함시킬 때,
각 장비의 정확한 카테고리도 함께 전달:
"FairTitanium은 RF_TIGHTENING 장비입니다 (laser가 아닙니다)."

또는 getEquipmentPromptSection()이 생성하는 텍스트에 카테고리를 포함:
"RF 타이트닝 장비: 써마지, 올리지오, 인모드, 페어티타늄, ..."

## 검증

수정 완료 후 바노바기 1건 재테스트:

1. priced_treatments 개수 비교: 7 → **목표 80+** (비급여표 80건 포함)
2. price_type: "regular" 항목이 80건 이상인지 (비급여표 출처)
3. regular_price + event_price 쌍이 있는지 확인 (이벤트 시술)
4. quantity, unit, price_per_unit이 채워져 있는지 확인
5. 가격 범위(min_price, max_price)가 파싱되었는지 (보톡스 30,000~180,000 등)
6. unregistered_equipment에 항목이 들어왔는지 확인 (0 → 목표 5+)
7. source: "website" vs "academic_paper" 구분 확인
8. instagram, youtube 필드 확인
9. FairTitanium subcategory가 RF인지 확인
```
