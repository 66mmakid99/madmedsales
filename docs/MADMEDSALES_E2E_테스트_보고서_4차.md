# MADMEDSALES E2E 테스트 보고서: 4차 (Firecrawl 보강)

## 1. 테스트 개요

### 목적
- 3차 Firecrawl 테스트에서 발견된 3가지 문제점(JSON 잘림 3건, 크롤 실패 2건, 페이지 제한) 보강
- crawl limit 확장(20→50)에 따른 markdown 수집량 변화 측정
- maxOutputTokens 확장(8000→16000)에 따른 JSON 파싱 오류 해결 검증

### 일시
| 테스트 | 일시 | 방식 |
|---|---|---|
| 3차 | 2026-02-22 | Firecrawl (crawl limit=20, maxTokens=8000) |
| **4차** | **2026-02-22** | **Firecrawl (crawl limit=50, maxTokens=16000)** |

### 4차 변경사항
| 항목 | 3차 | 4차 | 변경 이유 |
|---|---|---|---|
| crawl limit | 20 | **50** | 서브페이지 누락 방지 |
| maxOutputTokens | 8000 | **16000** | JSON 출력 잘림 3건 해결 |
| 닥터스 URL | branch/sinsa.php | **doctors365.co.kr/** (메인) | 브랜치 페이지 크롤 실패 |
| 제로 URL | zerodermaclinic.com | **m.zerodermaclinic.com** (모바일) | 데스크톱 사이트 차단 우회 시도 |
| map limit | 100 | **200** | 더 많은 URL 발견 |
| crawl timeout | 120초 | **180초** | 페이지 수 증가 대응 |

---

## 2. Phase 1 캡처 결과: 3차 vs 4차

| 병원 | 3차 페이지 | 4차 페이지 | 변화 | 3차 Markdown | 4차 Markdown | 변화 |
|---|---|---|---|---|---|---|
| 815의원 | 20 | **50** | +150% | 152K자 | **253K자** | +66% |
| 리멤버피부과 | 20 | **50** | +150% | 124K자 | **309K자** | +149% |
| 고운세상피부과 | 8 | 8 | 변동없음 | 40K자 | 39K자 | -2% |
| 닥터스피부과 | **0** | **50** | **∞** | **0자** | **218K자** | **∞** |
| 한미인의원 | 20 | **49** | +145% | 41K자 | **89K자** | +117% |
| 제로피부과 | **0** | **0** | 변동없음 | **0자** | **0자** | 여전히 실패 |
| 톡스앤필강서 | 20 | **50** | +150% | 135K자 | **367K자** | +172% |
| 이지함피부과 | 8 | 8 | 변동없음 | 12.8K자 | 12.4K자 | -3% |
| 바노바기피부과 | 20 | **50** | +150% | 139K자 | **238K자** | +71% |
| 신사루비의원 | 20 | 22 | +10% | 134K자 | 135K자 | +1% |
| **합계** | **136** | **337** | **+148%** | **775K자** | **1,661K자** | **+114%** |

### 캡처 핵심 변화

1. **닥터스피부과 완전 해결**: 메인 도메인(doctors365.co.kr)으로 변경 후 135개 URL 발견, 50페이지, 218K자 markdown 확보. 3차에서 0페이지 → 4차 50페이지. 장비/시술/의료진 페이지 모두 크롤 성공.

2. **제로피부과 여전히 실패**: 모바일 URL(m.zerodermaclinic.com)로 재시도했으나 0개 URL, 0페이지. 사이트가 Firecrawl/봇 접근을 완전 차단하는 것으로 판단. Playwright 방식만 유효.

3. **50페이지 확장 효과**: 815, 리멤버, 톡스앤필, 바노바기는 20→50페이지로 증가하며 markdown 66~172% 증가. 특히 톡스앤필(+172%)과 리멤버(+149%)에서 큰 효과.

4. **소규모 사이트 변동없음**: 고운세상(8페이지), 이지함(8페이지)은 사이트 자체가 작아서 limit 증가 효과 없음.

---

## 3. Phase 2 Gemini 분석 결과: 3차 vs 4차

| 병원 | 3차 결과 | 4차 장비 | 4차 시술 | 4차 가격 | 4차 의사 | 4차 Tokens(in/out) |
|---|---|---|---|---|---|---|
| 815의원 | **JSON 잘림** | **19** | **23** | 0 | 4 | 101,907/3,121 |
| 리멤버피부과 | **JSON 잘림** | **32** | **25** | 0 | 1 | 117,514/3,894 |
| 고운세상피부과 | 장비11/시술14 | 11 | 14 | 0 | 1 | 20,693/1,876 |
| 닥터스피부과 | **크롤 실패** | **21** | **15** | 0 | **14** | 114,549/2,970 |
| 한미인의원 | 장비23/시술21 | **26** | **36** | **23** | 1 | 52,212/3,993 |
| 제로피부과 | **크롤 실패** | **0 (실패)** | - | - | - | - |
| 톡스앤필강서 | **JSON 잘림** | **9** | **22** | **22** | 1 | 106,589/2,851 |
| 이지함피부과 | 장비0/시술3 | 0 | 4 | 0 | 0 | 8,334/510 |
| 바노바기피부과 | 장비13/시술23 | **18** | **29** | **21** | 5 | 108,948/5,466 |
| 신사루비의원 | 장비10/시술24 | 10 | 24 | 0 | 2 | 78,080/2,118 |
| **합계 (성공분)** | **57/85** | **146** | **192** | **66** | **29** | **708,826/26,799** |

### 분석 핵심 변화

1. **JSON 파싱 오류 완전 해결**: 3차에서 3건(815, 리멤버, 톡스앤필) 발생한 JSON 잘림이 4차에서 **0건**. maxOutputTokens 16000이 충분했으며, 실제 최대 출력은 5,466 토큰(바노바기)으로 여유 있음.

2. **finishReason 전수 STOP**: 9건 모두 정상 종료. MAX_TOKENS 도달 건 없음.

3. **성공률**: 3차 5/10 → 4차 **9/10** (+40%p). 유일한 실패는 제로피부과(크롤 자체 실패).

---

## 4. 병원별 상세 비교 (3차 vs 4차)

### 4.1 815의원 — JSON 잘림 해결

| 항목 | 3차 | 4차 |
|---|---|---|
| 캡처 | ✅ 20페이지, 152K자 | ✅ **50페이지, 253K자** |
| 분석 | ❌ JSON 파싱 오류 | ✅ **장비19, 시술23, 의사4** |
| URL 발견 | 34 | 35 |
| 장비 상세 | - | 프로파운드, 울쎄라, 써마지FLX, 인모드, 슈링크유니버스, 볼뉴머, 엔코어, 클라리티II, EMSCULPT NEO 등 19종 |

### 4.2 리멤버피부과 — JSON 잘림 해결

| 항목 | 3차 | 4차 |
|---|---|---|
| 캡처 | ✅ 20페이지, 124K자 | ✅ **50페이지, 309K자** |
| 분석 | ❌ JSON 파싱 오류 | ✅ **장비32, 시술25, 의사1** |
| 장비 상세 | - | 포토나QX-MAX, 슈링크유니버스, 매트릭셀프로, 시크릿RF, Excel V, 볼뉴머, 텐써마 등 32종 |

**특기**: 장비 32종은 전체 10개 병원 중 최다. 2차 Playwright(36종)에 근접하는 우수한 결과.

### 4.3 고운세상피부과 — 변동 없음

| 항목 | 3차 | 4차 |
|---|---|---|
| 캡처 | ✅ 8페이지, 40K자 | ✅ 8페이지, 39K자 |
| 분석 | 장비11, 시술14 | 장비11, 시술14 |

사이트 규모가 작아 limit 증가 효과 없음. 결과 일관성 확인.

### 4.4 닥터스피부과 — 크롤 실패 완전 해결

| 항목 | 3차 | 4차 |
|---|---|---|
| URL | branch/sinsa.php | **doctors365.co.kr/** (메인) |
| 캡처 | ❌ **0페이지, 0자** | ✅ **50페이지, 218K자** |
| 분석 | - | ✅ **장비21, 시술15, 의사14** |
| URL 발견 | 0 | **135** |
| 장비 상세 | - | 써마지FLX, 울쎄라, 울쎄라피프라임, 프로파운드, 덴서티, 온다리프팅, 인모드, 슈링크, 포텐자, 피코플러스, 피코웨이 등 21종 |

**최대 성과**: 3차 완전 실패에서 4차 풍부한 데이터 확보. 14명 의료진 정보도 추출. 프랜차이즈 사이트는 메인 도메인에서 크롤해야 함.

### 4.5 한미인의원 — 데이터 대폭 증가

| 항목 | 3차 | 4차 |
|---|---|---|
| 캡처 | ✅ 20페이지, 41K자 | ✅ **49페이지, 89K자** |
| 장비 | 23 | **26** (+13%) |
| 시술 | 21 | **36** (+71%) |
| 가격 | 9 | **23** (+156%) |
| 장비 상세 | - | 써마지FLX, 울쎄라피프라임, 세르프, 소프웨이브, 올리지오/X, 인모드, 슈링크, 피코플러스, 피코슈어 등 26종 |

**특기**: 가격 정보 23건은 전체 병원 중 최다. 50페이지 확장 효과가 가격 추출에 크게 기여.

### 4.6 제로피부과 — 여전히 실패

| 항목 | 3차 | 4차 |
|---|---|---|
| URL | zerodermaclinic.com | **m.zerodermaclinic.com** (모바일) |
| 캡처 | ❌ 0페이지, 0자 | ❌ **0페이지, 0자** |
| URL 발견 | 39 | **0** |

모바일 URL도 차단됨. 데스크톱 URL은 URL은 39개 발견했지만 크롤 0페이지, 모바일은 URL조차 0개. Firecrawl로는 접근 불가능한 사이트. Playwright 방식에서는 성공(1차: 38장비, 47시술).

### 4.7 톡스앤필강서 — JSON 잘림 해결 + 대폭 개선

| 항목 | 3차 | 4차 |
|---|---|---|
| 캡처 | ✅ 20페이지, 135K자 | ✅ **50페이지, 367K자** |
| 분석 | ❌ JSON 파싱 오류 | ✅ **장비9, 시술22, 가격22, 의사1** |
| 장비 상세 | - | 울쎄라, 슈링크유니버스, 인모드, 써마지, 온다리프팅, 볼뉴머, 할리우드스펙트라, 클라리티2, 코레지2.0 |

**특기**: 2차 Playwright에서는 장비1, 시술2밖에 추출 못한 사이트에서 4차 Firecrawl이 9장비, 22시술, 22가격 추출. Firecrawl의 SPA 처리 능력이 압도적.

### 4.8 이지함피부과 — 근본적 한계

| 항목 | 3차 | 4차 |
|---|---|---|
| 캡처 | ✅ 8페이지, 12.8K자 | ✅ 8페이지, 12.4K자 |
| 장비 | 0 | 0 |
| 시술 | 3 | 4 |

Wix SPA 구조로 모든 방식에서 데이터 추출이 근본적으로 어려움. limit 증가 효과 없음.

### 4.9 바노바기피부과 — 장비/시술/가격 대폭 증가

| 항목 | 3차 | 4차 |
|---|---|---|
| 캡처 | ✅ 20페이지, 139K자 | ✅ **50페이지, 238K자** |
| 장비 | 13 | **18** (+38%) |
| 시술 | 23 | **29** (+26%) |
| 가격 | 0 | **21** (신규!) |
| 의사 | 2 | **5** |
| 장비 상세 | - | 써마지FLX, 울쎄라, 슈링크, 인모드, 텐써마, 텐쎄라, 페어티타늄, 쓰리딥, 튠페이스, 튠라이너, 실펌 등 18종 |

**특기**: 3차 대비 장비+38%, 시술+26%, 가격 0→21건. 50페이지 확장으로 시술 상세 페이지(써마지, 울쎄라, 스킨부스터 등)를 개별 크롤하여 가격 정보 대량 확보.

### 4.10 신사루비의원 — 안정적

| 항목 | 3차 | 4차 |
|---|---|---|
| 캡처 | ✅ 20페이지, 134K자 | ✅ 22페이지, 135K자 |
| 장비 | 10 | 10 |
| 시술 | 24 | 24 |

영문 페이지 위주 크롤로 3차와 동일한 결과. 한국어 페이지 접근에 로그인 필요한 구조.

---

## 5. 1차~4차 종합 비교표

### 장비 추출 비교

| 병원 | 1차 | 2차 | 3차 | **4차** | **최고 방식** |
|---|---|---|---|---|---|
| 815의원 | 23 | 18 | -* | **19** | 1차 (23) |
| 리멤버피부과 | 37 | 36 | -* | **32** | 1차 (37) |
| 고운세상피부과 | 7 | **22** | 11 | 11 | 2차 (22) |
| 닥터스피부과 | 0 | **34** | 0** | **21** | 2차 (34) |
| 한미인의원 | 14 | 15 | 23 | **26** | **4차 (26)** |
| 제로피부과 | **38** | 17 | 0** | 0** | 1차 (38) |
| 톡스앤필강서 | 0 | 1 | -* | **9** | **4차 (9)** |
| 이지함피부과 | **5** | 0 | 0 | 0 | 1차 (5) |
| 바노바기피부과 | 1 | 6 | 13 | **18** | **4차 (18)** |
| 신사루비의원 | 16 | 15 | 10 | 10 | 1차 (16) |
| **합계** | 141 | **164** | 57* | **146** | - |

\* JSON 잘림으로 미추출
\*\* 크롤 자체 실패

### 시술 추출 비교

| 병원 | 1차 | 2차 | 3차 | **4차** | **최고 방식** |
|---|---|---|---|---|---|
| 815의원 | 36 | **43** | -* | 23 | 2차 (43) |
| 리멤버피부과 | 23 | **34** | -* | 25 | 2차 (34) |
| 고운세상피부과 | **29** | 22 | 14 | 14 | 1차 (29) |
| 닥터스피부과 | 0 | **26** | 0** | 15 | 2차 (26) |
| 한미인의원 | **45** | 30 | 21 | **36** | 1차 (45) |
| 제로피부과 | **47** | 14 | 0** | 0** | 1차 (47) |
| 톡스앤필강서 | 0 | 2 | -* | **22** | **4차 (22)** |
| 이지함피부과 | **14** | 6 | 3 | 4 | 1차 (14) |
| 바노바기피부과 | 36 | 27 | 23 | **29** | 1차 (36) |
| 신사루비의원 | 15 | **45** | 24 | 24 | 2차 (45) |
| **합계** | **245** | **249** | 85* | **192** | - |

### 가격 추출 비교

| 병원 | 1차 | 2차 | 3차 | **4차** | **최고 방식** |
|---|---|---|---|---|---|
| 815의원 | 0 | 0 | - | 0 | - |
| 리멤버피부과 | 0 | 0 | - | 0 | - |
| 고운세상피부과 | 0 | 0 | 0 | 0 | - |
| 닥터스피부과 | 0 | 0 | 0 | 0 | - |
| 한미인의원 | 4 | 1 | 9 | **23** | **4차 (23)** |
| 제로피부과 | 0 | 0 | 0 | 0 | - |
| 톡스앤필강서 | 0 | 0 | - | **22** | **4차 (22)** |
| 이지함피부과 | 0 | 0 | 0 | 0 | - |
| 바노바기피부과 | 2 | 0 | 0 | **21** | **4차 (21)** |
| 신사루비의원 | 0 | 0 | 0 | 0 | - |
| **합계** | **6** | **1** | **9*** | **66** | **4차 압도적** |

---

## 6. 핵심 발견사항

### 6.1 4차 해결된 문제 (3건 중 2건)

| 문제 | 원인 | 해결 방법 | 결과 |
|---|---|---|---|
| JSON 잘림 3건 | maxOutputTokens 8000 부족 | **16000으로 증가** | ✅ **완전 해결** (0건) |
| 닥터스 크롤 실패 | 브랜치 URL 크롤 불가 | **메인 도메인으로 변경** | ✅ **완전 해결** (50페이지) |
| 제로 크롤 실패 | 봇 차단 | 모바일 URL 시도 | ❌ **미해결** (여전히 차단) |

### 6.2 50페이지 확장 효과

| 지표 | 3차 (limit=20) | 4차 (limit=50) | 변화 |
|---|---|---|---|
| 총 페이지 | 136 | **337** | **+148%** |
| 총 Markdown | 775K자 | **1,661K자** | **+114%** |
| 평균 Markdown/병원 | 86K자 | **184K자** | **+114%** |
| 가격 정보 | 9건 | **66건** | **+633%** |
| 분석 성공률 | 5/10 | **9/10** | **+40%p** |

**가격 정보 폭증(+633%)**이 가장 주목할 만한 결과. 50페이지로 늘리면서 시술 상세 페이지까지 크롤되어 가격 정보가 대량 확보됨.

### 6.3 방식별 최적 사이트 유형 (업데이트)

| 사이트 유형 | 최적 방식 | 이유 |
|---|---|---|
| 기본 PHP/HTML | 2차 Playwright | Screenshot OCR 보완 가능 |
| 이미지 중심 | 2차 Playwright | OCR이 이미지 배너 읽기 |
| **모바일 SPA** | **4차 Firecrawl** | JS 렌더링 + 50페이지 크롤 |
| **풍부한 서브페이지** | **4차 Firecrawl** | 자동 서브페이지 발견 + 대량 크롤 |
| **가격 정보 추출** | **4차 Firecrawl** | 시술 상세 페이지 개별 크롤 |
| 프랜차이즈 | 4차 Firecrawl (메인 도메인) | 메인 도메인 전략 유효 |
| 봇 차단 사이트 | 2차 Playwright | Firecrawl 차단되는 사이트 존재 |

---

## 7. 비용 분석

### 7.1 API 비용 비교

| 항목 | 3차 | 4차 | 변화 |
|---|---|---|---|
| **Firecrawl 크레딧** | ~146 | **~347** | +138% |
| **Gemini 입력 토큰** | ~430K | **~709K** | +65% |
| **Gemini 출력 토큰** | ~18K | **~27K** | +50% |
| **Gemini 비용** | ~₩90 | **~₩150** | +67% |
| **캡처 소요시간** | ~20분 | **~25분** | +25% |
| **분석 소요시간** | ~10분 | **~9분** | -10% |
| **분석 성공률** | 5/10 | **9/10** | +80% |

### 7.2 병원당 예상 비용 (4차 기준, 대규모 운영)

| 항목 | 비용 |
|---|---|
| Firecrawl (~35크레딧/병원) | ~₩56/병원 |
| Gemini (~71K input + 2.7K output) | ~₩15/병원 |
| **합계** | **~₩71/병원** |

*Firecrawl 유료 기준: $16/1000크레딧 ≈ ₩1.6/크레딧

---

## 8. 결론 및 권고

### 8.1 4차 테스트 성과 요약

1. **JSON 파싱 오류 완전 해결**: maxOutputTokens 16000 충분. 실제 최대 사용 5,466토큰으로 여유 있음.
2. **닥터스피부과 해결**: 메인 도메인 전략 성공. 프랜차이즈 사이트는 메인 도메인에서 크롤해야 함.
3. **가격 정보 대폭 개선**: 6건(1차) → 1건(2차) → 9건(3차) → **66건(4차)**. 50페이지 확장의 가장 큰 수혜.
4. **톡스앤필 돌파**: 모든 방식 중 최고 결과. SPA 사이트에서 Firecrawl 압도적.
5. **제로피부과 미해결**: Firecrawl로는 접근 불가. Playwright 전용 대상.

### 8.2 하이브리드 파이프라인 최종 설계 권고

```
[1단계] Firecrawl 우선 시도 (limit=50, 비용 ~₩71/병원)
  ├── 성공 (50+ markdown 확보) → Gemini 분석 (maxTokens=16000)
  └── 실패 (0페이지 또는 <100자) → [2단계] Playwright 폴백

[2단계] Playwright 폴백 (비용 ~₩12/병원)
  ├── subpage-finder v2 + 듀얼 뷰포트
  ├── Screenshot OCR v2.0
  └── Gemini v5.0 프롬프트
```

### 8.3 추정 최적 결과 (하이브리드)

| 병원 | 최적 장비 | 소스 | 최적 가격 | 소스 |
|---|---|---|---|---|
| 815의원 | 23 | 1차 Playwright | 0 | - |
| 리멤버피부과 | 36 | 2차 Playwright | 0 | - |
| 고운세상피부과 | 22 | 2차 Playwright | 0 | - |
| 닥터스피부과 | 34 | 2차 Playwright | 0 | - |
| 한미인의원 | **26** | **4차 Firecrawl** | **23** | **4차 Firecrawl** |
| 제로피부과 | 38 | 1차 Playwright | 0 | - |
| 톡스앤필강서 | **9** | **4차 Firecrawl** | **22** | **4차 Firecrawl** |
| 이지함피부과 | 5 | 1차 Playwright | 0 | - |
| 바노바기피부과 | **18** | **4차 Firecrawl** | **21** | **4차 Firecrawl** |
| 신사루비의원 | 16 | 1차 Playwright | 0 | - |
| **합계** | **227** | - | **66** | - |

하이브리드 방식이면 장비 227건, 가격 66건으로 단일 방식 대비 최적의 결과를 달성할 수 있음.

---

*보고서 생성일: 2026-02-22*
*테스트 수행: Claude Code AI Assistant*
*스크립트: scripts/crawler/firecrawl-capture-v4.ts, scripts/crawler/firecrawl-analyze-v4.ts*
