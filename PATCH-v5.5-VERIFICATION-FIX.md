# MADMEDSALES v5.5 패치업 개발문서
# PATCH-v5.5-VERIFICATION-FIX

> **작성일**: 2026-02-25 (v2 업데이트)
> **작성 근거**: 3개 병원(안산엔비, 동안중심, 포에버) 보고서 vs 홈페이지 vs **106페이지 원본 크롤링 데이터** 3중 대조 검증
> **원본 데이터**: raw_crawl_data_3hospitals_20260225.docx (마크다운 텍스트 + 355장 스크린샷 + 104건 OCR + 3개 Gemini JSON)
> **목적**: Phase 2 (49개 병원 전체 실행) 전에 반드시 수정해야 할 결함 패치 + 보고서 품질 개선
> **v2 변경**: 원본 데이터 대조로 3개 결함 원인 확정(모두 Gemini 분류 실패), 결함 7 신규 추가(DB URL 불일치), 데이터 완성도 평가 추가

---

## 변경 요약

| # | 구분 | 제목 | 심각도 | 원인 (v2 확정) |
|---|------|------|--------|----------------|
| 1 | Gemini 분류 결함 | TORR RF 보유 감지 실패 | 🚨 치명적 | Gemini가 네비게이션 메뉴 텍스트를 장비로 매핑 못함 |
| 2 | Gemini 분류 결함 | 의료기기 대량 누락 (네비게이션 미파싱) | 🔴 심각 | 시술명→장비명 매핑 실패 (누락률 57%) |
| 3 | Gemini 추출 결함 | 연락처 채널 누락 (SNS 링크 미수집) | 🔴 심각 | 마크다운 [![alt](img)](URL) 패턴에서 URL 무시 |
| 4 | 보고서 개선 | 요약→전체 데이터 보고 전환 | 🟡 개선 | - |
| 5 | 보고서 개선 | DOCX 테이블 포맷 개선 | 🟡 개선 | - |
| 6 | 데이터 정합성 | 병원 위치명 정확성 검증 | 🟡 개선 | 보고서 생성 시 DB 등록명 우선 사용 |
| 7 | DB 정합성 | **DB URL 불일치 검증** (v2 신규) | 🔴 심각 | DB에 "포에버의원(신사)" 등록 → 실제 크롤링 URL은 안산점 |

---

## 결함 1: TORR RF 보유 감지 실패 🚨

### 현상

동안중심의원(dongancenter.com)이 TORR RF를 이미 보유하고 시술 메뉴에 노출하고 있음에도 보고서에 "TORR RF 보유 여부: 없음"으로 출력됨.

**홈페이지에서 확인된 TORR 관련 메뉴 4개:**
- "토르 리프팅" → /landing/175.htm
- "토르엔드 리프팅" → /landing/132.htm
- "토르쎄라" → /landing/134.htm
- "토르엔드+바디" → /landing/133.htm

### 왜 치명적인가

MADMEDSALES의 핵심 목적은 "TORR RF를 안 가진 병원에 영업하는 것". 이미 보유한 병원에 "TORR RF 도입하시죠"라고 연락하면 신뢰 즉시 붕괴. TORR 보유 감지는 100% 정확해야 함.

### 원인 확정 (v2: 원본 데이터 대조 결과)

> ⚠️ v1에서 3가지 가능성을 제시했으나, 원본 크롤링 데이터(106페이지) 대조 결과 **가능성 B: Gemini 분류 누락**으로 확정.

**원본 마크다운 텍스트 (동안중심의원 페이지 1/50, 라인 2652~2662):**
```
[토르 리프팅](http://www.dongancenter.com/landing/175.htm)
[토르엔드 리프팅](http://www.dongancenter.com/landing/132.htm)
[토르쎄라](http://www.dongancenter.com/landing/134.htm)
[토르엔드+바디](http://www.dongancenter.com/landing/133.htm)
```
→ 네비게이션 메뉴에 "토르" 키워드 **5번 반복 등장**. 크롤링은 완벽하게 성공했음.

**Gemini JSON 결과:**
medical_devices 28종 나열 — "토르", "TORR" 키워드 **0건**

**확정 원인:** 크롤링은 성공했으나 Gemini가 네비게이션 메뉴 텍스트를 "UI 메뉴"로 간주하여 의료기기로 분류하지 않음. "토르 리프팅"을 시술명으로만 인식하고 TORR RF 장비 보유로 매핑 실패.

~~가능성 A: 크롤링 범위 부족~~ → ❌ 원본에 데이터 존재 확인, 탈락
~~가능성 C: TORR 키워드 미정의~~ → ❌ 키워드 이전에 Gemini가 장비 자체를 인식 못함

**가능성 C: 네비게이션 HTML에서 텍스트 추출 실패**
- 메뉴가 이미지(gnb_01_off.png 등)로 되어있고 텍스트가 a태그 안에만 있음
- Firecrawl 마크다운 변환 시 네비게이션 영역이 잘리거나 무시됨

### 수정 방향

#### 수정 1-A: TORR RF 전용 감지 로직 추가

2단계 Gemini 분류와 **별도로**, 크롤링된 전체 텍스트에서 TORR RF 관련 키워드를 직접 검색하는 독립 모듈을 추가한다.

```
[TORR RF 감지 키워드 목록]
정확히 매칭해야 하는 것:
- "TORR" (대소문자 무관)
- "토르" (단독 또는 복합어의 앞부분)
- "토르RF"
- "토르리프팅" 또는 "토르 리프팅"
- "토르엔드" 또는 "토르 엔드"
- "토르쎄라"
- "TORR RF"
- "MPR" (TORR RF의 기술명)
- "토로이달" 또는 "Toroidal" (TORR RF 고유 기술)

제외해야 하는 것 (오탐 방지):
- "토르말린" (광물 이름)
- "torr" (압력 단위, 과학 맥락)
- "Thor" (일반 단어, 단 의료기기 맥락이면 포함)
```

#### 수정 1-B: 네비게이션 구조 파싱

Firecrawl 크롤링 결과의 마크다운에서 네비게이션 영역(`<nav>`, `<ul class="gnb">`, 메뉴 구조)의 텍스트도 분석 대상에 포함한다.

특히 a태그의 텍스트와 href를 모두 추출한다:
```
예시: <a href="/landing/175.htm">토르 리프팅</a>
→ 추출: { text: "토르 리프팅", url: "/landing/175.htm" }
→ TORR RF 감지 트리거
```

#### 수정 1-C: TORR RF 감지 결과 세분화

현재: `torr_rf_detected: true/false`

변경:
```json
{
  "torr_rf": {
    "detected": true,
    "evidence": [
      {
        "keyword": "토르 리프팅",
        "source": "navigation_menu",
        "url": "/landing/175.htm"
      },
      {
        "keyword": "토르엔드 리프팅",
        "source": "navigation_menu",
        "url": "/landing/132.htm"
      }
    ],
    "products_found": ["TORR RF (토르리프팅)", "TORR END (토르엔드)"],
    "confidence": "high"
  }
}
```

#### 수정 1-D: 보고서 출력 변경

AS-IS:
```
TORR RF 보유 여부: 없음
```

TO-BE (미보유 시):
```
TORR RF 보유 여부: 없음
  감지 키워드 스캔: 0건 매칭
  감지 신뢰도: HIGH (전체 텍스트 + 네비게이션 + URL 스캔 완료)
```

TO-BE (보유 시):
```
TORR RF 보유 여부: 보유 확인
  감지 근거:
    - "토르 리프팅" → /landing/175.htm (네비게이션 메뉴)
    - "토르엔드 리프팅" → /landing/132.htm (네비게이션 메뉴)
    - "토르쎄라" → /landing/134.htm (네비게이션 메뉴)
    - "토르엔드+바디" → /landing/133.htm (네비게이션 메뉴)
  보유 제품: TORR RF, TORR END
  영업 전략: 기존 사용자 → 추가 팁/소모품/업그레이드 제안
```

### 검증 방법

동안중심의원(dongancenter.com) 재크롤링 후:
- [ ] TORR RF 보유 여부 = "보유 확인" 출력되는지
- [ ] 감지 근거 4건 이상 표시되는지
- [ ] "토르쎄라" 같은 복합 시술명도 감지되는지

---

## 결함 2: 의료기기 대량 누락 🔴

### 현상

동안중심의원 보고서: 장비 25종 + 주사제 3종 = 28종
실제 홈페이지 네비게이션: 장비 50종+ + 주사제 15종+ = 65종+

**누락률 약 57%** (28/65)

### 원인 확정 (v2: 원본 데이터 대조 결과)

> ⚠️ 원본 마크다운에 네비게이션 메뉴 텍스트로 장비명이 **전부 존재**. 크롤링 성공, Gemini 분류 실패.

**원본에 있지만 Gemini JSON에 없는 장비 30+종:**
온다(Onda), 텐쎄라, 텐써마, 써니RF, 써펙트, 스칼렛S, 슈링크, 젤틱, 에너젯, 엑센트 엘리트, BBL Forever+, 헤일로, 핀브라이트, 리팟, 레드터치 pro, 오푸스, 이브 타이탄, 이브 시너지, 리에이치, 셀리뉴, M스컬프트 NEO, 마론핏, 엠셀라, 쇽웨이브 F1, 엑스웨이브, 뉴스카임팩트울트라펄스, 플라즈마 레이저, 스타룩스1540XD, Forever Bare+, 골드PTT, 루메카, 튠스컬프트 등

**확정 원인:** Gemini가 "시술명→장비명" 매핑 실패. 네비게이션 메뉴의 "울쎄라 이용시술" → Ulthera(HIFU), "써마지FLX 이용시술" → Thermage FLX(RF) 같은 매핑을 못함. 메뉴 텍스트를 "콘텐츠"가 아닌 "UI 요소"로 무시.

### 수정 방향

#### 수정 2-A: 네비게이션 메뉴 전체 텍스트 추출

1단계 크롤링(Firecrawl) 결과에서 메인 페이지의 네비게이션 HTML을 별도로 파싱한다.

```
추출 대상:
- <nav> 태그 내부 전체
- <ul> + <li> 구조의 메뉴 트리
- 각 a태그의 텍스트 + href
- 메뉴 계층 구조 (대분류 > 중분류 > 시술명)
```

이렇게 추출한 "네비게이션 시술/장비 목록"을 2단계 Gemini 분류에 별도 입력으로 넣는다.

#### 수정 2-B: Gemini 프롬프트에 네비게이션 데이터 섹션 추가

현재 2단계 프롬프트:
```
아래 텍스트에서 의료기기를 분류하세요:
[크롤링된 본문 텍스트]
```

변경:
```
아래 텍스트에서 의료기기를 분류하세요:

=== 본문 텍스트 ===
[크롤링된 본문 텍스트]

=== 네비게이션 메뉴에서 추출된 시술/장비 목록 ===
[메뉴 구조에서 추출한 장비명+시술명 리스트]

주의: 네비게이션 메뉴의 항목도 반드시 의료기기 목록에 포함할 것.
네비게이션에 "울쎄라 이용시술", "써마지FLX 이용시술" 등이 있으면
울쎄라(HIFU), 써마지(RF)를 의료기기로 추출할 것.
```

#### 수정 2-C: "시술명 → 장비명" 매핑 테이블

병원 홈페이지는 장비명이 아닌 시술명으로 표기하는 경우가 많음.

```
매핑 예시:
"울쎄라 이용시술" → 장비: Ulthera, 분류: HIFU
"써마지FLX 이용시술" → 장비: Thermage FLX, 분류: RF
"엠페이스 이용시술" → 장비: Emface, 분류: EMS_magnetic
"젤틱 이용시술" → 장비: CoolSculpting/Zeltiq, 분류: cryotherapy
"리포소닉 이용시술" → 장비: Liposonic, 분류: HIFU
"스컬트라/엘란쎄" → 주사제: Sculptra(collagen_stimulator), Ellanse(collagen_stimulator)
"토르 리프팅" → 장비: TORR RF, 분류: RF ← 결함1과 연동
"토르엔드 리프팅" → 장비: TORR END, 분류: RF ← 결함1과 연동
```

이 매핑 테이블을 Gemini 프롬프트에 참고자료로 포함하거나, 별도 JSON으로 관리한다.

### 검증 방법

동안중심의원 재크롤링 후:
- [ ] 장비 50종 이상 추출되는지
- [ ] 주사제 15종 이상 추출되는지
- [ ] 네비게이션에만 있고 본문에 없는 장비도 추출되는지

---

## 결함 3: 연락처 채널 누락 🔴

### 현상

안산엔비의원 홈페이지 메인 상단에 5개 SNS 아이콘이 명확히 존재:
- 카카오톡: pf.kakao.com/_PxcqCn
- 블로그: blog.naver.com/demiraenb
- 인스타그램: instagram.com/sangaimoon
- 페이스북: facebook.com/ansannbclinic/
- 유튜브: youtube.com/channel/UCdfR-lwsCdvllhlrDPhTYzA

보고서 결과:
- 카카오톡: "nbclinic7550" (불일치 — 어디서 온 값인지 불명)
- 블로그: "없음" ❌
- 인스타그램: "없음" ❌
- 페이스북: 항목 자체 없음 ❌
- 유튜브: ✅ 일치

### 원인 확정 (v2: 원본 데이터 대조 결과)

> ⚠️ 원본 마크다운에 SNS URL이 **4페이지 x 2세트 = 8번 반복 등장**. 크롤링 완벽 성공, Gemini 추출 실패.

**원본 마크다운 (라인 16~25):**
```
[![카카오톡](img)](https://pf.kakao.com/_PxcqCn)
[![블로그](img)](https://blog.naver.com/demiraenb)
[![인스타그램](img)](https://instagram.com/sangaimoon)
[![페이스북](img)](https://www.facebook.com/ansannbclinic/)
[![유튜브](img)](https://www.youtube.com/channel/UCdfR-...)
```

**Gemini JSON 결과:**
```json
"kakao_channel": "nbclinic7550",    ← OCR에서 뽑은 텍스트 (라인 1356 "카카오톡 TALK nbclinic7550")
"instagram": null,                   ← ❌ instagram.com/sangaimoon 무시
"blog": null,                        ← ❌ blog.naver.com/demiraenb 무시
"youtube": "https://youtube.com/..." ← ✅ 유일 성공
```
페이스북 필드는 JSON 스키마에 아예 없음.

**확정 원인:** Gemini가 마크다운의 `[![alt](img)](URL)` 패턴에서 URL을 연락처로 인식 못함. 텍스트 본문과 OCR에서만 연락처 추출. 카카오톡만 OCR 이미지에서 "nbclinic7550" 텍스트가 있어서 잡혔으나 URL이 아닌 채팅 ID라 불완전.

### 수정 방향

#### 수정 3-A: 연락처 전용 URL 패턴 매칭

크롤링된 전체 HTML/마크다운에서 아래 URL 패턴을 정규식으로 직접 검색한다.
이건 Gemini에 맡기지 않고 코드 레벨에서 직접 추출.

```
[연락처 URL 패턴]
카카오톡채널:
  - pf.kakao.com/
  - plus.kakao.com/
  - open.kakao.com/

블로그:
  - blog.naver.com/
  - m.blog.naver.com/
  - blog.daum.net/
  - tistory.com

인스타그램:
  - instagram.com/
  - www.instagram.com/

페이스북:
  - facebook.com/
  - www.facebook.com/
  - m.facebook.com/

유튜브:
  - youtube.com/
  - www.youtube.com/
  - youtu.be/

네이버예약:
  - booking.naver.com/
  - m.place.naver.com/

트위터/X:
  - twitter.com/
  - x.com/

네이버톡톡:
  - talk.naver.com/

전화번호:
  - tel:로 시작하는 href
  - 0XX-XXXX-XXXX 패턴
  - 15XX-XXXX 패턴 (대표번호)

이메일:
  - mailto: href
  - xxx@xxx.xxx 패턴
```

#### 수정 3-B: Gemini 프롬프트 보완

2단계 분류 프롬프트에 연락처 추출 강화 지시를 추가:

```
=== 연락처 추출 규칙 ===
1. HTML의 모든 a태그 href에서 SNS/연락처 URL을 추출할 것
2. 이미지 아이콘 안에 숨어있는 링크도 반드시 추출할 것
3. 카카오톡, 블로그, 인스타, 페이스북, 유튜브, 네이버예약, 네이버톡톡을 모두 별도 항목으로 보고할 것
4. 전화번호가 여러 개인 경우 모두 수집할 것 (대표번호, 상담전화 등)
5. "없음"으로 판단하기 전에 HTML 소스의 a태그를 한 번 더 확인할 것
```

#### 수정 3-C: 보고서 연락처 항목 확장

현재 보고서 연락처 항목:
```
이메일 / 전화 / 주소 / 카카오톡 / 네이버예약 / 인스타그램 / 유튜브 / 블로그
```

확장:
```
이메일 / 전화(대표) / 전화(기타) / 주소 / 카카오톡채널 / 네이버예약 / 네이버톡톡 / 인스타그램 / 페이스북 / 유튜브 / 블로그 / 기타SNS
```

**각 항목에 URL 전체를 기입** (현재 "nbclinic7550"처럼 불완전한 값 금지)

### 검증 방법

안산엔비의원 재크롤링 후:
- [ ] 카카오톡 = pf.kakao.com/_PxcqCn
- [ ] 블로그 = blog.naver.com/demiraenb
- [ ] 인스타 = instagram.com/sangaimoon
- [ ] 페이스북 = facebook.com/ansannbclinic/
- [ ] 유튜브 = youtube.com/channel/UCdfR-lwsCdvllhlrDPhTYzA

---

## 개선 4: 보고서 전체 데이터 보고 전환 🟡

### 현재 문제

보고서가 "요약본" 수준이라 실제 크롤링된 데이터를 신뢰할 수 없음.

예시:
- "학술활동 7건" → 7건이 뭔지 안 보여줌
- "시술 139개" → 139개가 뭔지 안 보여줌
- "이벤트 3건" → 무슨 이벤트인지 안 보여줌
- 의료기기 제조사 대부분 "-" → 실제로 없는 건지 추출 못한 건지 불명

### 변경 원칙

**"긁어온 데이터 전부를 잘 정리해서 보여준다"**

보고서는 크롤링 결과의 **전수 검사 보고서**여야 함. 데이터를 숨기면 검증이 불가능함.

### 섹션별 변경 사항

#### 4-1. 의사 섹션

AS-IS:
```
| 이름 | 직책 | 전문분야 | 이름 검증 |
| 기문상 | 원장 | 미용의학, 탈모, 피부 | ocr_only |
```

TO-BE:
```
| 이름 | 직책 | 전문분야 | 이름 검증 | 추출 근거 |
| 기문상 | 원장 | 미용의학, 탈모, 피부 | ocr_only | /doctor 페이지 OCR |

[원문 텍스트]
기문상 원장
- 대한미용성형레이저의학회(대미레) 정회원
- 대한레이저피부모발학회 정회원
- 대한비만미용체형학회 정회원
- (추출된 경력/자격사항 전체)
```

#### 4-2. 학술활동 섹션

AS-IS:
```
학술활동: 7건 — 양호
```

TO-BE:
```
학술활동: 8건

| # | 활동명 | 연도 | 유형 | 역할 | 추출 근거 |
| 1 | 2025 ASLS와 ICAP 학술대회 참가 및 강연 | 2025 | 학회 | 강연자 | 메인페이지 학술 섹션 |
| 2 | 2025 ASLS TOKYO 학술대회 | 2025 | 학회 | 참가 | 메인페이지 학술 섹션 |
| 3 | 2025 안산시의사회 춘계학술대회 | 2025 | 학회 | 참가 | 메인페이지 학술 섹션 |
| 4 | [책 편찬] 대한레이저피부모발학회 '모발학' | 2025 | 저서 | 편찬 | 메인페이지 학술 섹션 |
| 5 | 2025 대미레 미용의료기기 박람회 및 춘계학술대회 | 2025 | 학회 | 강연자 | 메인페이지 학술 섹션 |
| 6 | K-Med Expo Vietnam 2024 제2회 베트남 의료기기 박람회 | 2024 | 박람회 | 강연자 | 메인페이지 학술 섹션 |
| 7 | AFAS 아시아국제미용의학포럼 제20회 한국미용외과의학회 | 2024 | 학회 | 참가 | 메인페이지 학술 섹션 |
| 8 | 2024 대미레 미용의료기기 박람회 및 춘계학술대회 | 2024 | 학회 | 강연자 | 메인페이지 학술 섹션 |
```

#### 4-3. 의료기기 섹션

AS-IS:
```
장비 (device) — 25종
| # | 장비명 | 제조사 | 분류 |
| 1 | Ulthera | - | HIFU |
```

TO-BE:
```
장비 (device) — 52종

| # | 장비명 | 제조사 | 분류 | 추출 근거 | 관련 시술 |
| 1 | Ulthera | Merz | HIFU | 네비게이션 + 랜딩페이지 | 울쎄라 리프팅, 울써마지펜타 |
| 2 | Ulthera Prime | Merz | HIFU | 네비게이션 /landing/229.htm | 울쎄라피 프라임 |
| 3 | Thermage FLX | Solta Medical | RF | 네비게이션 + 본문 | 써마지FLX, 써마지FLX펜타 |
| 4 | TORR RF | BRITZMEDI | RF | 네비게이션 /landing/175.htm | 토르리프팅, 토르쎄라 |
...

[보충] 네비게이션에서만 확인되고 본문에 상세 없는 장비:
| 장비명 | 추출 근거 | 비고 |
| 셀리뉴 | /landing/211.htm | 본문 미크롤링 |
| 이브 타이탄 | /landing/218.htm | 본문 미크롤링 |
```

#### 4-4. 시술 섹션

AS-IS:
```
| # | 시술명 | 가격 | 비고 |
| - | 가격 확보 시술 없음 | - | - |
```

TO-BE (가격 없는 경우에도 시술 목록은 전부 나열):
```
시술: 139개 (가격 확보 0건)

[가격 확보 시술] — 없음

[시술 전체 목록]
아래는 크롤링에서 추출된 시술명 전체입니다.

리프팅 계열 (23건):
  울쎄라피 프라임, 세르프, 티타늄 리프팅, 발레리나리프팅,
  MiniFx+Forma+Lumeca, 아우라리프팅, 실루엣쎄라, 실루엣소프트,
  써마지FLX, 써마지CPT, 울쎄라, 텐쎄라, 텐써마, 써니RF, 써펙트,
  스타일리프팅, 쿨리프팅, 슈링크리프팅, 토르리프팅, 토르엔드리프팅,
  에르메스리프팅, 에너젯, 풀뎁쓰 리페어

색소 계열 (15건):
  레드터치 pro, 헤일로, 콰트로빔, 디스커버리 피코, 리팟,
  피코 사파이어 토닝+785, 핀브라이트, 앱솔루트 기가피코,
  실크토닝, Q-plus R 루비레이저, 프락셀1927, MAX G, M22,
  CNB 1440, LDM

(이하 전체 카테고리별 나열)
```

#### 4-5. 이벤트 섹션

AS-IS:
```
이벤트: 2건 — 양호
```

TO-BE:
```
이벤트: 5건

| # | 이벤트명 | 유형 | 내용 | 추출 근거 |
| 1 | NB 여드름 실속 패키지 | 프로모션 | 여드름 치료 패키지 할인 | 메인 프로모션 슬라이드 |
| 2 | NB 반영구 두피문신 EVENT | 프로모션 | 두피문신 이벤트 | 메인 프로모션 슬라이드 |
| 3 | 학술대회 팝업 | 팝업 | 학술대회 참가 홍보 | 팝업 pop_251203.jpg |
| 4 | 윤곽조각주사 팝업 | 팝업 | 시술 홍보 | 팝업 pop_260211_01.jpg |
| 5 | 스킨부스터 팝업 | 팝업 | 시술 홍보 | 팝업 pop_260211_02.jpg |
```

#### 4-6. 연락처 섹션

AS-IS:
```
| 채널 | 정보 |
| 이메일 | 없음 |
| 전화 | 031-485-7550 |
```

TO-BE:
```
| 채널 | 정보 | 추출 근거 |
| 이메일 | 없음 | - |
| 전화(대표) | 031-485-7550 | tel: 링크 |
| 전화(기타) | 031-485-7570 | 하단 tel: 링크 |
| 주소 | 경기도 안산시 단원구 고잔로 76 영풍프라자 213,214호 | 푸터 텍스트 |
| 카카오톡 | https://pf.kakao.com/_PxcqCn | 상단 아이콘 링크 |
| 네이버예약 | 없음 | - |
| 인스타그램 | https://instagram.com/sangaimoon | 상단 아이콘 링크 |
| 페이스북 | https://www.facebook.com/ansannbclinic/ | 상단 아이콘 링크 |
| 유튜브 | https://www.youtube.com/channel/UCdfR-lwsCdvllhlrDPhTYzA | 상단 아이콘 링크 |
| 블로그 | https://blog.naver.com/demiraenb | 상단 아이콘 링크 |
```

#### 4-7. 영업 인사이트 섹션

AS-IS:
```
RF/리프팅 가격대: N/A
의사진: 1명, 학술활동: 활발
컨택: 전화 (031-485-7550)
```

TO-BE:
```
[영업 인사이트]

TORR RF 현황:
  보유 여부: 없음
  경쟁 RF 장비: 없음 (이 병원은 RF 장비 미보유)
  영업 포인트: RF 리프팅 신규 도입 제안 적합

의사 프로파일:
  기문상 원장 — 탈모/모발이식 중점, 학술활동 활발(연 4회+)
  해외 학회 강연 경험(베트남, 일본, 인도네시아)
  → 신기술 수용도 높을 것으로 추정

가격 경쟁력 분석:
  콜라겐 재생 주사(스컬트라+올리디아+리쥬오+아디페) 85만원
  → 복합 패키지 위주, 개별 시술 가격 비공개
  RF 리프팅 가격대: N/A (RF 장비 미보유이므로)

우선 컨택 채널:
  1순위: 카카오톡 (pf.kakao.com/_PxcqCn)
  2순위: 전화 (031-485-7550)
  3순위: 인스타그램 DM (sangaimoon)
```

---

## 개선 5: DOCX 테이블 포맷 개선 🟡

### 현재 문제

1. 표 셀 안에서 텍스트가 세로쓰기처럼 되어있음 (셀 너비 부족)
2. 열 간격이 균등하지 않아서 내용이 찌그러짐
3. 긴 텍스트(전문분야, 시술명 등)가 한 글자씩 줄바꿈됨

### 원인

docx 생성 시 테이블 columnWidths 설정이 부적절하거나 미설정.
특히 "전문분야"나 "분류" 같은 긴 텍스트 열에 충분한 너비를 배정하지 않음.

### 수정 방향

#### 5-A: 열 너비 비율 재설계

각 테이블별 열 너비를 내용 길이에 맞게 재설계한다.

**의사 테이블** (US Letter 기준 9360 DXA):
```
| 이름(15%) | 직책(12%) | 전문분야(40%) | 이름검증(13%) | 추출근거(20%) |
| 1404     | 1123     | 3744          | 1217          | 1872          |
```

**의료기기 테이블**:
```
| #(5%) | 장비명(25%) | 제조사(15%) | 분류(15%) | 추출근거(20%) | 관련시술(20%) |
| 468   | 2340       | 1404       | 1404      | 1872          | 1872          |
```

**시술 테이블**:
```
| #(5%) | 시술명(40%) | 가격(15%) | 비고(40%) |
| 468   | 3744       | 1404      | 3744      |
```

**연락처 테이블**:
```
| 채널(15%) | 정보(60%) | 추출근거(25%) |
| 1404     | 5616      | 2340         |
```

#### 5-B: 셀 패딩 추가

모든 테이블 셀에 여백을 추가하여 텍스트가 셀 경계에 붙지 않도록 한다:
```
margins: { top: 80, bottom: 80, left: 120, right: 120 }
```

#### 5-C: 긴 텍스트 자동 줄바꿈 처리

전문분야, 시술명 등 긴 텍스트는 쉼표(,) 기준으로 줄바꿈하여 가독성을 높인다.

AS-IS (한 줄에 모두):
```
미용의학, 탈모, 피부, 비만, 여드름, 모발이식
```

TO-BE (적절히 줄바꿈):
```
미용의학, 탈모, 피부
비만, 여드름, 모발이식
```

#### 5-D: 테이블 스타일 통일

- 헤더 행: 배경색 #D5E8F0, 볼드, 가운데 정렬
- 데이터 행: 흰 배경, 왼쪽 정렬
- 짝수 행: 배경색 #F5F5F5 (줄무늬)
- 테두리: 연한 회색 #CCCCCC, 1pt
- 폰트: 본문과 동일 (Arial 10pt 또는 맑은 고딕 10pt)

---

## 개선 6: 병원 위치명 정확성 검증 🟡

### 현상

포에버의원(신사) 보고서의 위치가 "신사"로 표기되었으나 실제 크롤링 데이터는 안산점.
Gemini는 정확히 "포에버의원 안산점"으로 분석했으나, 보고서 생성 코드에서 DB 등록명("신사")을 우선 사용.

### 수정 방향

#### 6-A: 위치명 추출 우선순위

1순위: 실제 주소에서 추출 (시/구 단위)
2순위: URL 서브도메인에서 추정
3순위: 사이트 내 표기

```
예시:
주소 "경기 안산시 단원구 고잔로 88" → 위치명: "안산"
주소 "서울시 강남구 압구정로48길 26" → 위치명: "강남/압구정"
```

#### 6-B: 프랜차이즈 병원 지점 식별

포에버의원처럼 전국 프랜차이즈인 경우:
- URL 서브도메인으로 지점 식별 (as=안산, gn=강남 등)
- 보고서에 "포에버의원 **안산점**"으로 명확 표기
- "전국 XX개 지점 네트워크 병원"이라는 맥락 정보도 기록

#### 6-C: DB 등록명 vs Gemini 분석명 불일치 경고 (v2 추가)

```json
// 보고서 생성 시 크로스체크
{
  "db_name": "포에버의원(신사)",
  "gemini_name": "포에버의원 안산점",
  "name_match": false,
  "warning": "⚠️ DB 등록 병원명과 크롤링 결과 병원명이 불일치합니다. DB URL을 확인하세요."
}
```

---

## 결함 7: DB URL 불일치 검증 🔴 (v2 신규)

### 현상

DB에 "포에버의원(신사)"로 등록되어 있고 크롤링 URL이 `as.4-ever.co.kr`인데, 이 URL은 **안산점**의 URL임.

**포에버의원 전국 지점 URL 구조** (본사 사이트 확인):
```
gn.4-ever.co.kr  → 강남점 (서울 강남구 논현동 66-24)
gs.4-ever.co.kr  → 강서점
mp.4-ever.co.kr  → 마포점
wr.4-ever.co.kr  → 위례점
cd.4-ever.co.kr  → 청담점
ch.4-ever.co.kr  → 천호점
hd.4everclinic.com → 홍대점
as.4-ever.co.kr  → 안산점 ← 실제로 크롤링된 곳
bd.4-ever.co.kr  → 분당점
sw.4-ever.co.kr  → 수원점
... (총 20개 지점)
```

"신사점"이라는 지점은 존재하지 않음. 가장 가까운 건 **강남점**(gn.4-ever.co.kr, 신사동 인근).

### 왜 심각한가

**영업 대상 병원의 URL이 틀리면, 아예 다른 병원을 분석한 결과로 영업하게 됨.**
49개 병원 목록에 이런 URL 오류가 더 있을 수 있으며, Phase 2 전에 전수 점검 필수.

### 수정 방향

#### 7-A: Gemini 분석 병원명 vs DB 등록 병원명 자동 크로스체크

크롤링 후 Gemini가 분석한 `hospital_name`과 DB에 등록된 `hospital_name`을 비교.
불일치 시 경고 플래그:

```json
{
  "hospital_name_mismatch": true,
  "db_name": "포에버의원(신사)",
  "crawled_name": "포에버의원 안산점",
  "crawled_address": "경기 안산시 단원구 고잔로 88",
  "action_required": "DB URL 확인 필요 — 의도한 지점의 URL인지 검증"
}
```

#### 7-B: Phase 2 전 49개 병원 URL 전수 점검

```
점검 방법:
1. 각 병원 URL에 대해 Firecrawl로 메인 페이지 1페이지만 간이 크롤링
2. 페이지 내 병원명/주소 텍스트 추출
3. DB 등록 병원명/주소와 비교
4. 불일치 건 목록 작성 → 수동 수정 후 Phase 2 진행
```

#### 7-C: 프랜차이즈 병원 분리 등록

포에버의원처럼 서브도메인으로 지점이 나뉘는 프랜차이즈 병원은:
- 각 지점을 별도 레코드로 DB에 등록
- URL에 서브도메인 명시
- "본점"과 "지점"을 구분 표기

---

## 적용 순서 (Claude Code 작업 순서)

### Step 0: DB URL 전수 점검 (v2 추가 — 최우선)

```
0-1. 49개 병원 URL 간이 크롤링 (메인 페이지 1개만)
0-2. 크롤링된 병원명/주소 vs DB 등록 정보 비교
0-3. 불일치 건 수동 수정
0-4. 프랜차이즈 병원 지점 분리 등록
```

### Step 1: 코드 수정 (recrawl-v5.ts)

```
1-1. TORR RF 전용 감지 모듈 추가
     - 키워드 목록 상수 정의
     - 전체 텍스트 + 네비게이션에서 독립 검색
     - 결과를 JSON 구조로 저장

1-2. 네비게이션 파싱 모듈 추가
     - Firecrawl 마크다운에서 메뉴 구조 추출
     - a태그 텍스트 + href 리스트 생성
     - 이걸 2단계 Gemini 입력에 추가

1-3. 연락처 URL 패턴 매칭 모듈 추가
     - 정규식으로 SNS URL 직접 검색
     - Gemini 결과와 병합 (Gemini 못 찾은 것 보완)

1-4. 위치명 추출 로직 수정
     - 주소 기반 추출 우선
     - 프랜차이즈 지점 식별
```

### Step 2: Gemini 프롬프트 수정

```
2-1. 2단계 분류 프롬프트에 네비게이션 데이터 섹션 추가
2-2. 연락처 추출 강화 지시 추가
2-3. "시술명→장비명" 매핑 참고자료 추가
2-4. TORR RF 관련 키워드 명시 추가
```

### Step 3: 보고서 생성 코드 수정 (docx)

```
3-1. 각 섹션 전체 데이터 출력으로 변경
3-2. 테이블 columnWidths 재설계
3-3. 셀 패딩 추가
3-4. 헤더/데이터행 스타일 통일
3-5. "추출 근거" 열 추가
3-6. 영업 인사이트 섹션 확장
3-7. TORR RF 섹션 세분화
```

### Step 4: 검증

```
4-1. 동안중심의원 재크롤링 → TORR RF 감지 확인
4-2. 안산엔비의원 재크롤링 → 연락처 5개 채널 확인
4-3. 포에버의원 재크롤링 → 위치명 "안산" 확인
4-4. 3개 병원 모두 보고서 형식 확인
```

---

## 금지사항 추가 (기존 34개 + 신규 5개)

```
35. TORR RF 보유 판단을 Gemini 분류에만 의존 금지 — 독립 키워드 스캔 필수
36. 네비게이션 메뉴 텍스트 무시 금지 — 메뉴에 있는 장비/시술도 반드시 추출
37. 연락처 URL을 Gemini에만 의존 금지 — 코드 레벨 정규식 매칭 병행 필수
38. 보고서에서 데이터 요약/생략 금지 — 크롤링된 전체 데이터를 섹션별로 정리하여 전부 표시
39. DB 등록 병원명을 무조건 신뢰 금지 — Gemini 분석 병원명과 크로스체크 필수 (v2 추가)
```

---

## 원본 데이터 기준 — 크롤링 데이터 완성도 평가 (v2 추가)

### 평가 기준

원본 크롤링 데이터(마크다운+OCR+스크린샷)를 "100% 기준"으로 놓고,
Gemini JSON 분석 결과가 몇 퍼센트를 정확하게 추출했는지 평가.

### 병원별 데이터 완성도

#### 1. 안산엔비의원 (talmostop.com) — 4페이지 크롤링

| 항목 | 원본 데이터 | Gemini 추출 | 완성도 | 비고 |
|------|------------|-------------|--------|------|
| 병원명 | 엔비의원 | ✅ 엔비의원 | 100% | |
| 의사 | 1명 (문상아 원장) | ✅ 1명 | 100% | |
| 학술활동 | 8건 | 7건 | **87%** | 1건 누락 |
| 의료기기(장비) | 0종 (텍스트 언급 없음) | 0종 | 100% | 소규모 병원이라 장비 미노출 |
| 주사제 | 7종 | ✅ 7종 | 100% | |
| 시술 | 8건 | ✅ 8건 | 100% | |
| 이벤트 | 4건+ (팝업 포함) | 2건 | **50%** | 팝업 이벤트 누락 |
| 연락처 | 5채널 (카톡/블로그/인스타/페북/유튜브) | 2채널 (카톡ID/유튜브) | **40%** | ❌ 블로그/인스타/페북 누락 |
| 주소/전화 | ✅ | ✅ | 100% | |
| 진료시간 | ✅ | ✅ | 100% | |
| **종합** | | | **~80%** | 연락처 누락이 가장 심각 |

#### 2. 동안중심의원 (dongancenter.com) — 50페이지 크롤링

| 항목 | 원본 데이터 | Gemini 추출 | 완성도 | 비고 |
|------|------------|-------------|--------|------|
| 병원명 | 동안중심의원 | ✅ | 100% | |
| 의사 | 3명 (조창환/구소연/이진형) | ✅ 3명 | 100% | 경력/학력 포함 |
| 학술활동 | 14건+ | 14건 | 100% | |
| 의료기기(장비) | **65종+** (네비게이션 메뉴) | 25종 | **38%** | 🚨 30+종 누락 |
| 주사제 | 15종+ | 3종 | **20%** | 🚨 대량 누락 |
| TORR RF 보유 | "토르" 5회 등장 | **미감지** | **0%** | 🚨 치명적 결함 |
| 시술 | 139건+ (메뉴 기준) | 25건 | **18%** | 대량 누락 |
| 이벤트 | 3건 | 3건 | 100% | |
| 연락처 | 7채널 | 7채널 | 100% | 동안중심은 연락처 텍스트 노출이 좋음 |
| 주소/전화 | ✅ | ✅ | 100% | |
| 진료시간 | ✅ | ✅ | 100% | |
| **종합** | | | **~55%** | 의료기기/시술 대량 누락 + TORR RF 치명적 |

#### 3. 포에버의원 안산점 (as.4-ever.co.kr) — 52페이지 크롤링

| 항목 | 원본 데이터 | Gemini 추출 | 완성도 | 비고 |
|------|------------|-------------|--------|------|
| 병원명 | 포에버의원 안산점 | ✅ 포에버의원 안산점 | 100% | Gemini는 정확 |
| 의사 | 2명 (이건민/이충일) | ✅ 2명 | 100% | |
| 학술활동 | 0건 | 0건 | 100% | 지점이라 학술활동 없음 |
| 의료기기(장비) | 25종 | 25종 | 100% | 프랜차이즈라 표준화된 구조 |
| 주사제 | 3종 | 3종 | 100% | |
| 시술 | 25건 | 25건 | 100% | |
| 이벤트 | 3건 | 3건 | 100% | |
| 연락처 | 2채널 (전화/카톡) | 2채널 | 100% | ⚠️ 단, 카톡 URL 미추출 (텍스트만) |
| 주소/전화 | ✅ | ✅ | 100% | |
| **종합** | | | **~98%** | 프랜차이즈 표준 구조라 추출 양호 |
| **DB 정합성** | DB="포에버의원(신사)" | 실제=안산점 | **불일치** | 🔴 DB URL 오류 |

### 3개 병원 종합 데이터 완성도

```
            안산엔비   동안중심   포에버안산   평균
크롤링 성공    ✅        ✅        ✅        100%  ← Firecrawl은 완벽
기본정보      100%      100%      100%      100%
의사정보      100%      100%      100%      100%
학술활동       87%      100%      100%       96%
의료기기       100%       38%      100%       79%  ← 🚨 동안중심 심각
연락처          40%      100%      100%       80%  ← 🚨 안산엔비 심각
시술            100%       18%      100%       73%  ← 🚨 동안중심 심각
이벤트          50%      100%      100%       83%
TORR RF 감지    N/A        0%      N/A          0%  ← 🚨 치명적
DB 정합성       ✅         ✅        ❌          67%  ← 🔴 URL 오류
─────────────────────────────────────────────────
전체 종합       ~80%      ~55%      ~98%       ~78%
```

### 핵심 인사이트

**크롤링(Firecrawl) 자체는 100% 완벽했다.** 106페이지 분량의 마크다운, 355장 스크린샷, 104건 OCR 모두 정상 수집.

**문제는 전부 Gemini 분류/추출 단계에서 발생:**
- 네비게이션 메뉴 텍스트를 "콘텐츠"로 인식 못함 → 장비/시술 대량 누락
- 마크다운 링크 구문 [![](img)](URL)에서 URL 추출 못함 → 연락처 누락
- 시술명→장비명 매핑 능력 부족 → TORR RF 등 장비 미감지

**사이트 구조에 따라 완성도가 극단적으로 갈림:**
- 프랜차이즈(포에버): 표준화된 구조 → 98% 완성도
- 대형 전문병원(동안중심): 복잡한 네비게이션+200개 랜딩페이지 → 55% 완성도
- 소형 병원(안산엔비): 간단한 구조지만 SNS 아이콘 방식 → 80% 완성도

**패치 후 목표:** 전 병원 유형에서 **90%+ 완성도** 달성

---

## 이 패치가 완료되면

- TORR RF 보유/미보유 판정 정확도: 현재 불명 → **목표 100%**
- 의료기기 추출율: 현재 ~43% (동안중심 기준) → **목표 90%+**
- 연락처 채널 추출율: 현재 ~40% (안산엔비 기준) → **목표 95%+**
- 보고서 데이터 완전성: 요약본 → **전수 보고서**
- 보고서 가독성: 세로쓰기/찌그러짐 → **정상 테이블**
- DB URL 정합성: 미검증 → **49개 전수 점검 완료**
- 전체 데이터 완성도: 현재 ~78% → **목표 90%+**
